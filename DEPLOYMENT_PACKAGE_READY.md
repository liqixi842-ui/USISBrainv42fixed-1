# âœ… USIS Brain è¿ç§»åŒ…å·²å°±ç»ª

**ç”Ÿæˆæ—¶é—´**: 2025-11-18  
**ç›®æ ‡æœåŠ¡å™¨**: 150.242.90.36 (Rocky 9)  
**ç”Ÿäº§åŸŸå**: https://myusis.net  
**ReplitåŸŸå**: liqixi888.replit.appï¼ˆä¿ç•™ä¸ºå¼€å‘ç¯å¢ƒï¼‰

---

## ğŸ“¦ è¿ç§»åŒ…å†…å®¹

### æ ¸å¿ƒè„šæœ¬ï¼ˆ6ä¸ªï¼Œå·²è®¾ç½®å¯æ‰§è¡Œæƒé™ï¼‰

```
migration/
â”œâ”€â”€ 1_export_database.sh           [2.4K] æ•°æ®åº“å¯¼å‡º
â”œâ”€â”€ 2_restore_database.sh          [2.8K] æ•°æ®åº“æ¢å¤
â”œâ”€â”€ 3_deploy_to_server.sh          [9.2K] ä¸€é”®éƒ¨ç½²ï¼ˆæ ¸å¿ƒï¼‰
â”œâ”€â”€ 4_configure_nginx.sh           [3.2K] Nginxé…ç½®
â”œâ”€â”€ 5_setup_https.sh               [2.6K] HTTPSè¯ä¹¦
â””â”€â”€ 6_verify_deployment.sh         [8.6K] éƒ¨ç½²éªŒè¯
```

### æ–‡æ¡£ï¼ˆ4ä¸ªï¼‰

```
migration/
â”œâ”€â”€ README.md                      [9.9K] è¯¦ç»†è¿ç§»æŒ‡å—
â”œâ”€â”€ QUICK_START.txt               [6.8K] 5åˆ†é’Ÿå¿«é€Ÿå…¥é—¨
â”œâ”€â”€ MIGRATION_CHECKLIST.md        [7.1K] è¿ç§»æ£€æŸ¥æ¸…å•
â””â”€â”€ .env.production.template       [4.2K] ç”Ÿäº§ç¯å¢ƒé…ç½®æ¨¡æ¿
```

### ä»£ç ä¿®å¤

```
âœ… v3_dev/services/devBotHandler.js
   ç¬¬230è¡Œ: é»˜è®¤URLå·²æ›´æ–°ä¸º https://myusis.net
```

---

## ğŸš€ ç«‹å³å¼€å§‹è¿ç§»

### æ–¹å¼ A: å¿«é€Ÿå…¥é—¨ï¼ˆæ¨èæ–°æ‰‹ï¼‰

```bash
# æ‰“å¼€å¿«é€ŸæŒ‡å—
cat migration/QUICK_START.txt

# æŒ‰æ­¥éª¤æ‰§è¡Œï¼ˆåªéœ€5åˆ†é’Ÿï¼‰
```

### æ–¹å¼ B: è¯¦ç»†æ–‡æ¡£ï¼ˆæ¨èè¿ç»´ï¼‰

```bash
# æ‰“å¼€è¯¦ç»†æŒ‡å—
less migration/README.md

# æˆ–åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹
```

### æ–¹å¼ C: æ£€æŸ¥æ¸…å•ï¼ˆæ¨èå›¢é˜Ÿï¼‰

```bash
# ä½¿ç”¨æ£€æŸ¥æ¸…å•è·Ÿè¸ªè¿›åº¦
cat migration/MIGRATION_CHECKLIST.md
```

---

## ğŸ“‹ è¿ç§»æ­¥éª¤é¢„è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. åœ¨ Replit ä¸Šå¯¼å‡ºæ•°æ®åº“                               â”‚
â”‚    ./migration/1_export_database.sh                     â”‚
â”‚    [2åˆ†é’Ÿ]                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æ‰“åŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨                                      â”‚
â”‚    tar + scp                                            â”‚
â”‚    [5åˆ†é’Ÿ]                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ä¸€é”®éƒ¨ç½²ï¼ˆè‡ªåŠ¨åŒ–ï¼‰                                    â”‚
â”‚    sudo ./migration/3_deploy_to_server.sh               â”‚
â”‚    [10åˆ†é’Ÿ]                                             â”‚
â”‚    - å®‰è£… Node.js, PostgreSQL, Nginx                   â”‚
â”‚    - åˆ›å»ºç”¨æˆ·å’Œæ•°æ®åº“                                    â”‚
â”‚    - å®‰è£…ä¾èµ–                                           â”‚
â”‚    - é…ç½® PM2                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. æ¢å¤æ•°æ®åº“                                           â”‚
â”‚    sudo -u usis ./migration/2_restore_database.sh       â”‚
â”‚    [2åˆ†é’Ÿ]                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. é…ç½® Nginx                                           â”‚
â”‚    sudo ./migration/4_configure_nginx.sh                â”‚
â”‚    [2åˆ†é’Ÿ]                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. é…ç½® HTTPS                                           â”‚
â”‚    sudo ./migration/5_setup_https.sh                    â”‚
â”‚    [3åˆ†é’Ÿ]                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. éªŒè¯éƒ¨ç½²                                             â”‚
â”‚    ./migration/6_verify_deployment.sh                   â”‚
â”‚    [1åˆ†é’Ÿ]                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
                    âœ… å®Œæˆï¼
```

**æ€»è€—æ—¶**: çº¦ 25-30 åˆ†é’Ÿ

---

## ğŸ”§ å¿…éœ€çš„ç¯å¢ƒå˜é‡

åœ¨æœåŠ¡å™¨ä¸Šé…ç½® `/opt/usis-brain/.env`ï¼š

### âš ï¸ å¿…é¡»é…ç½®ï¼ˆç³»ç»Ÿæ— æ³•å¯åŠ¨ï¼‰

```bash
# æ ¸å¿ƒ
NODE_ENV=production
REPLIT_DEPLOYMENT_URL=https://myusis.net

# æ•°æ®åº“ï¼ˆè‡ªåŠ¨é…ç½®ï¼‰
DATABASE_URL=postgresql://usis_brain:å¯†ç @localhost:5432/usis_brain

# Telegram
TELEGRAM_BOT_TOKEN=ä»@BotFatherè·å–

# AIï¼ˆè‡³å°‘OpenAIï¼‰
OPENAI_API_KEY=sk-proj-...

# é‡‘èæ•°æ®ï¼ˆè‡³å°‘Finnhubï¼‰
FINNHUB_API_KEY=ä»finnhub.ioè·å–

# PDFç”Ÿæˆ
DOC_RAPTOR_API_KEY=ä»docraptor.comè·å–
DOC_RAPTOR_TEST_MODE=false  # âš ï¸ å¿…é¡»ä¸ºfalse
```

### âœ… æ¨èé…ç½®ï¼ˆå¢å¼ºåŠŸèƒ½ï¼‰

```bash
ANTHROPIC_API_KEY=...      # Claudeé•¿æ–‡åˆ†æ
GOOGLE_AI_API_KEY=...      # Geminiå¿«é€Ÿå“åº”
TWELVE_DATA_API_KEY=...    # å…¨çƒå¸‚åœºæ•°æ®
BROWSERLESS_API_KEY=...    # å›¾è¡¨æˆªå›¾
```

### ğŸ“ å®Œæ•´æ¨¡æ¿

```bash
cp migration/.env.production.template /opt/usis-brain/.env
nano /opt/usis-brain/.env  # å¡«å…¥æ‰€æœ‰Keys
```

---

## âœ… ä»£ç ä¿®å¤ç¡®è®¤

### devBotHandler.js å·²æ›´æ–°

**æ–‡ä»¶**: `v3_dev/services/devBotHandler.js`  
**è¡Œå·**: 230  
**ä¿®æ”¹å‰**:
```javascript
'https://liqixi888.replit.app'
```

**ä¿®æ”¹å**:
```javascript
'https://myusis.net'
```

**å½±å“**: Telegram Botç”Ÿæˆç ”æŠ¥æ—¶å°†é»˜è®¤è°ƒç”¨æ–°åŸŸå

---

## ğŸ“Š ç³»ç»Ÿæ¶æ„å¯¹æ¯”

### è¿ç§»å‰ï¼ˆReplitï¼‰

```
ç”¨æˆ· â†’ liqixi888.replit.app â†’ Replit Reserved VM
                               â”œâ”€ Node.js (å†…ç½®)
                               â”œâ”€ PostgreSQL (Neon)
                               â””â”€ HTTPS (è‡ªåŠ¨)
```

### è¿ç§»åï¼ˆè‡ªæœ‰æœåŠ¡å™¨ï¼‰

```
ç”¨æˆ· â†’ myusis.net â†’ 150.242.90.36
                    â”œâ”€ Nginx (åå‘ä»£ç†)
                    â”œâ”€ PM2 â†’ Node.js
                    â”œâ”€ PostgreSQL 15
                    â””â”€ Certbot (Let's Encrypt)
```

### Replitæ–°è§’è‰²ï¼ˆä¿ç•™ï¼‰

```
å¼€å‘è€… â†’ liqixi888.replit.app â†’ å¼€å‘/æµ‹è¯•ç¯å¢ƒ
                                 â”œâ”€ ä»£ç è°ƒè¯•
                                 â”œâ”€ åŠŸèƒ½æµ‹è¯•
                                 â””â”€ å¯é€‰ï¼šåå‘ä»£ç†åˆ°ç”Ÿäº§æœåŠ¡å™¨
```

---

## ğŸ”’ å®‰å…¨æ¸…å•

- [x] é»˜è®¤URLå·²æ›´æ–°ä¸º myusis.net
- [ ] .env æƒé™è®¾ä¸º 600
- [ ] PostgreSQL ä»…ç›‘å¬ localhost
- [ ] é˜²ç«å¢™ä»…å¼€æ”¾ 22, 80, 443
- [ ] SSHå¯†é’¥ç™»å½•ï¼ˆç¦ç”¨å¯†ç ï¼‰
- [ ] SSLè¯ä¹¦è‡ªåŠ¨ç»­æœŸ
- [ ] å®šæœŸæ•°æ®åº“å¤‡ä»½
- [ ] æ•æ„Ÿæ—¥å¿—å·²æ¸…ç†

---

## ğŸ“± è¿ç§»åæ“ä½œ

### 1. æ›´æ–° Telegram Bot Webhook

```bash
curl https://api.telegram.org/bot<YOUR_TOKEN>/setWebhook?url=https://myusis.net/webhook/<YOUR_TOKEN>
```

### 2. æ›´æ–° N8N å·¥ä½œæµ

å°†æ‰€æœ‰å·¥ä½œæµä¸­çš„ `liqixi888.replit.app` æ›¿æ¢ä¸º `myusis.net`

### 3. é…ç½®ç›‘æ§ï¼ˆå¯é€‰ï¼‰

- UptimeRobot: https://myusis.net/healthï¼ˆæ¯5åˆ†é’Ÿï¼‰
- å‘Šè­¦é‚®ç®±: æ‚¨çš„é‚®ç®±

### 4. å®šæœŸå¤‡ä»½

```bash
# æ·»åŠ åˆ° crontabï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹ï¼‰
0 2 * * * cd /opt/usis-brain && ./migration/1_export_database.sh
```

---

## ğŸ†˜ æ•…éšœæ’æŸ¥

### åº”ç”¨æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹PM2æ—¥å¿—
sudo -u usis pm2 logs

# æ‰‹åŠ¨å¯åŠ¨æµ‹è¯•
cd /opt/usis-brain
node index.js
```

### æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æµ‹è¯•è¿æ¥
psql postgresql://usis_brain:å¯†ç @localhost:5432/usis_brain

# æ£€æŸ¥PostgreSQLçŠ¶æ€
sudo systemctl status postgresql
```

### Nginx 502é”™è¯¯

```bash
# æ£€æŸ¥Node.jsæ˜¯å¦è¿è¡Œ
sudo -u usis pm2 status

# æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tuln | grep 3000
```

### SSLè¯ä¹¦å¤±è´¥

```bash
# æ£€æŸ¥DNS
dig myusis.net

# æµ‹è¯•HTTP
curl http://myusis.net/health

# Dry-runæµ‹è¯•
sudo certbot --nginx -d myusis.net --dry-run
```

---

## ğŸ“ è·å–å¸®åŠ©

### è¯¦ç»†æ–‡æ¡£
```bash
cat migration/README.md
```

### æ£€æŸ¥æ¸…å•
```bash
cat migration/MIGRATION_CHECKLIST.md
```

### å¿«é€Ÿå‚è€ƒ
```bash
cat migration/QUICK_START.txt
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

**ç°åœ¨å°±å¼€å§‹è¿ç§»ï¼Ÿ**

### æ­¥éª¤ 1: å¯¼å‡ºæ•°æ®åº“ï¼ˆåœ¨Replitä¸Šï¼‰
```bash
cd /home/runner/USIS_Brain
./migration/1_export_database.sh
```

### æ­¥éª¤ 2: æŸ¥çœ‹å¿«é€ŸæŒ‡å—
```bash
cat migration/QUICK_START.txt
```

### æ­¥éª¤ 3: å¼€å§‹éƒ¨ç½²
æŒ‰ç…§ `QUICK_START.txt` æˆ– `README.md` æ‰§è¡Œå‰©ä½™æ­¥éª¤

---

## âœ¨ è¿ç§»å®Œæˆå

æ‚¨å°†æ‹¥æœ‰ï¼š
- âœ… å®Œå…¨æ§åˆ¶çš„ç”Ÿäº§æœåŠ¡å™¨ï¼ˆ150.242.90.36ï¼‰
- âœ… è‡ªå®šä¹‰åŸŸåï¼ˆmyusis.netï¼‰
- âœ… è‡ªåŠ¨ç»­æœŸçš„HTTPSè¯ä¹¦
- âœ… ä¸“ä¸šçš„è¿›ç¨‹ç®¡ç†ï¼ˆPM2ï¼‰
- âœ… é«˜æ€§èƒ½åå‘ä»£ç†ï¼ˆNginxï¼‰
- âœ… å®Œæ•´çš„æ•°æ®åº“å¤‡ä»½
- âœ… ä¿ç•™Replitä½œä¸ºå¼€å‘ç¯å¢ƒ

**æˆæœ¬å¯¹æ¯”**:
- Replit Reserved VM: $20-160/æœˆ
- è‡ªæœ‰æœåŠ¡å™¨: ä»…æœåŠ¡å™¨æˆæœ¬ï¼ˆæ— å¹³å°è´¹ç”¨ï¼‰

---

## ğŸ“‹ éªŒè¯æˆåŠŸçš„æ ‡å¿—

```bash
âœ… curl https://myusis.net/health
   â†’ { "ok": true, "status": "ok" }

âœ… curl https://myusis.net/v3/report/test
   â†’ { "ok": true, "env": "v3-dev", ... }

âœ… curl https://myusis.net/v3/report/AAPL?format=json
   â†’ å®Œæ•´çš„20é¡µç ”æŠ¥JSON

âœ… sudo -u usis pm2 status
   â†’ usis-brain | online | 0

âœ… ./migration/6_verify_deployment.sh
   â†’ âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡!
```

---

**å‡†å¤‡å¥½äº†å—ï¼Ÿç«‹å³å¼€å§‹è¿ç§»ï¼ğŸš€**

å‚è€ƒæ–‡æ¡£: `migration/README.md` æˆ– `migration/QUICK_START.txt`
