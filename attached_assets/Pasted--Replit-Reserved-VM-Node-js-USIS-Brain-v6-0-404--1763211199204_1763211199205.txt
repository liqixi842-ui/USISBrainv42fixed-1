（从这里开始复制）

你好，我在 Replit 的 Reserved VM 上部署一个 Node.js 项目（USIS Brain v6.0），现在遇到端口 / 404 的问题，麻烦帮我按下面思路一起确认和调整。

一、当前现象

项目：USIS Brain v6.0（Node.js 应用）

部署方式：Replit Reserved VM（GCE deployment）

应用可以正常启动，日志里能看到类似内容：

USIS Brain v6.0 online on port 8080


但是：通过 Replit 部署出来的公网地址（*.sisko.replit.dev）访问：

/

/health

/brain/orchestrate

都返回 404（Google 前端 404）。

二、目前大致配置（请帮我一起核对）
1）Node.js 代码监听端口

现在服务大概是这样启动的（示意）：

const PORT = process.env.PORT || 8080;
app.listen(PORT, () => {
  console.log(`USIS Brain v6.0 online on port ${PORT}`);
});


也就是说：

代码层面默认监听的是 8080。

2）.replit 配置里有两个 ports（这是关键问题）

在 .replit 文件底部目前类似这样（示意）：

[deployment]
deploymentTarget = "gce"
run = ["sh", "-c", "PORT=3000 ENABLE_TELEGRAM=true ENABLE_NEWS_SYSTEM=true node index.js"]

[[ports]]
localPort = 3000
externalPort = 3000

[[ports]]
localPort = 8080
externalPort = 80


也就是说：

run 里写的是：PORT=3000

实际代码里：默认用 8080

.replit 里有 两个 [[ports]] 配置块：一个 3000，一个 8080

我现在是在 Reserved VM 环境，按文档只支持一个 external port 映射

推测问题原因：
端口配置不一致 + 多个 [[ports]]，导致负载均衡/映射混乱，外部请求虽然到了 VM，但没有正确转发到 Node.js 监听的端口 → 公网访问 404。

三、我希望调整成的“最终统一方案”

我这边不需要多种选择，只要一个稳定方案即可。
目标是：内部统一用 3000 端口，外部用 80 暴露。

✅ 目标状态：

Node.js 服务监听：process.env.PORT || 3000

.replit 的 run 使用：PORT=3000

.replit 里只保留 一个 [[ports]] 配置

externalPort 继续使用 80（对外 HTTP 端口）

四、具体想请你们帮忙做的调整
1）修改 Node.js 主文件（如 index.js）

请把监听端口改成下面这样（默认走 3000）：

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(`USIS Brain v6.0 online on port ${PORT}`);
});


之前是 8080，现在统一成 3000。

2）修改 .replit 底部配置（只保留一个 ports）

请帮我把 .replit 里所有旧的 [[ports]] 删除，
换成下面这一份唯一的配置（示例最终版）：

[deployment]
deploymentTarget = "gce"
run = ["sh", "-c", "PORT=3000 ENABLE_TELEGRAM=true ENABLE_NEWS_SYSTEM=true node index.js"]

[[ports]]
localPort = 3000
externalPort = 80


关键点是：

只保留这一段 [[ports]]

localPort = 3000 要和应用监听端口一致

externalPort = 80 作为公网访问端口保持不变

3）重新部署 Reserved VM

保存 .replit

重新 Deploy / Redeploy Reserved VM

等部署完成

4）帮忙验证一下

部署完成后，麻烦帮我验证：

公网 URL（https://<我的>.sisko.replit.dev/health）是否能正常返回应用的响应（而不是 404）；

其他路由（例如 /brain/orchestrate）是否也可以正常访问。

五、总结一句话

之前为了适配旧环境曾经用过 8080

现在项目已经在 Reserved VM / GCE 上运行

目前 .replit 里存在多个 [[ports]] + 端口不统一

想麻烦你们帮我把：代码 / PORT 环境变量 / .replit 里的 localPort 全部统一为 3000，只保留一个 [[ports]]，外部继续用 80。

谢谢你们的支持 🙏

（复制到这里结束）