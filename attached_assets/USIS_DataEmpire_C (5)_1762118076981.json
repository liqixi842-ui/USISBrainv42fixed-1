{
  "name": "USIS_DataEmpire_C",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -92512,
        352
      ],
      "id": "5616b023-2462-4fb7-b57b-1b25a146d712",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "url": "https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=IBM&apikey=demo",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -92064,
        256
      ],
      "id": "1678969f-da9f-448a-9d51-de16704a42ad",
      "name": "C_Quote_AVDemo"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ceb77cf0-13c8-40d0-b2ff-1627947ea722",
              "name": "symbol",
              "value": "={{$json[\"Global Quote\"][\"01. symbol\"]}}",
              "type": "string"
            },
            {
              "id": "0efe98fe-0d93-4a12-91b8-6205c4245916",
              "name": "price",
              "value": "={{Number($json[\"Global Quote\"][\"05. price\"])}}",
              "type": "string"
            },
            {
              "id": "b207c76a-3793-4bac-98ce-39bdb204e6aa",
              "name": "change",
              "value": "={{Number($json[\"Global Quote\"][\"09. change\"])}}",
              "type": "string"
            },
            {
              "id": "e2b6101d-5911-4f14-bfa9-65318689b89f",
              "name": "pct",
              "value": "={{$json[\"Global Quote\"][\"10. change percent\"]}}",
              "type": "string"
            },
            {
              "id": "f34ee983-95e3-4579-9af7-3c22a1120db1",
              "name": "time",
              "value": "={{$json[\"Global Quote\"][\"07. latest trading day\"]}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -91840,
        256
      ],
      "id": "f152f0c5-9e5d-477c-a4bf-aa5d9159ab21",
      "name": "C_Map_Quote"
    },
    {
      "parameters": {
        "url": "https://news.google.com/rss/search?q=IBM&hl=en-US&gl=US&ceid=US:en",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -91616,
        304
      ],
      "id": "d91ce481-1472-43cd-84a6-0a0b97ffa95d",
      "name": "C_RSS_News"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.xml",
      "typeVersion": 1,
      "position": [
        -91392,
        304
      ],
      "id": "4c8f2c1a-d5f8-44ba-a9cd-6999cd8f29dd",
      "name": "C_Convert_RSS_JSON"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "d5e1b111-ec31-42f0-8993-f59b7d93467b",
              "name": "=top_headlines ",
              "value": "={{   (() => {     const ch = $json.rss?.channel;     const channel = Array.isArray(ch) ? ch[0] : ch || {};     const itemsRaw = channel.item;     const items = Array.isArray(itemsRaw) ? itemsRaw : (itemsRaw ? [itemsRaw] : []);     return items.slice(0, 3).map(i => ({       title: i.title || \"\",       url: i.link || \"\",       publishedAt: i.pubDate || i.isoDate || \"\",       source: (i.source || (i.link ? (\"\" + i.link).split(\"/\")[2] : \"\")) || \"\"     }));   })() }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -91168,
        304
      ],
      "id": "304f1489-53f4-438f-a5f9-ca2d44dee9d5",
      "name": "C_Map_News"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -90944,
        256
      ],
      "id": "b2349206-99dc-4cda-8a97-d9fcbe741650",
      "name": "C_Merge_QuoteNews"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://node-js-liqixi842.replit.app/brain/feed",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "symbol",
              "value": "={{ $json.symbol }}"
            },
            {
              "name": "price",
              "value": "={{ $json.price }}"
            },
            {
              "name": "change",
              "value": "={{ $json.change }}"
            },
            {
              "name": "pct",
              "value": "={{ $json.pct }}"
            },
            {
              "name": "time",
              "value": "={{ $json.time }}"
            },
            {
              "name": "top_headlines",
              "value": "={{ $json.top_headlines }}"
            },
            {
              "name": "tweets",
              "value": "={{ $json.tweets }}"
            },
            {
              "name": "sentiment_index",
              "value": "={{ $json.sentiment_index }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -90496,
        352
      ],
      "id": "e4f9e0c3-14e3-4cda-95bc-81289e1c492a",
      "name": "C_Post_BrainFeed"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "id"
        },
        "responses": {
          "values": [
            {
              "role": "system",
              "content": "è¯·è¾“å‡ºä¸¥æ ¼çš„ JSON æ ¼å¼ï¼š\n{\n  \"Analyst\": \"...\",\n  \"Commentator\": \"...\",\n  \"Trader\": \"...\",\n  \"Reporter\": \"...\"\n}\nåªè¿”å› JSONï¼Œä¸è¦å¤šä½™æ–‡å­—ã€‚"
            },
            {
              "content": "={{ $json.body?.brain_output || $json.brain_output || $json.reason || $json.decision || \"è¯·æŠŠè¾“å…¥ä¿¡æ¯æ•´ç†ä¸ºå››è§’è§‚ç‚¹ï¼šAnalyst / Commentator / Trader / Reporterã€‚\" }}\n"
            }
          ]
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 2,
      "position": [
        -92288,
        1184
      ],
      "id": "e275e39e-9396-42f0-bc97-6b0399857cec",
      "name": "D_RoleRouter",
      "credentials": {
        "openAiApi": {
          "id": "kCv97lI74mm9IFic",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// è§£æ RoleRouter çš„æ–‡æœ¬è¾“å‡ºæˆç»“æ„åŒ– JSON\nconst text = $json.output?.[0]?.content?.[0]?.text || \"\";\nreturn [\n  {\n    json: {\n      raw_text: text,\n      timestamp: new Date().toISOString(),\n      roles: {\n        analyst: text.match(/\"Analyst\"\\s*:\\s*\"(.*?)\"/s)?.[1]?.trim() || \"\",\n        commentator: text.match(/\"Commentator\"\\s*:\\s*\"(.*?)\"/s)?.[1]?.trim() || \"\",\n        trader: text.match(/\"Trader\"\\s*:\\s*\"(.*?)\"/s)?.[1]?.trim() || \"\",\n        reporter: text.match(/\"Reporter\"\\s*:\\s*\"(.*?)\"/s)?.[1]?.trim() || \"\"\n      }\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -91936,
        1184
      ],
      "id": "128c7fc5-eba1-43ee-8f7c-f4204d6519e6",
      "name": "D_ParseRoleOutput"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -92512,
        1600
      ],
      "id": "bd2bcf2b-76a6-47b8-8bb3-caec62ce8e4c",
      "name": "No Operation, do nothing"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "start_d_from_b",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -92512,
        1184
      ],
      "id": "2347e865-5273-44ce-aed5-bfe62373e554",
      "name": "Start_D_from_B",
      "webhookId": "66e9196d-e240-4908-8885-9abd087074e0"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "id-1",
              "name": "caption",
              "value": "={{ (() => { const si = $json.sentiment_index || 0; const emoji = si >= 30 ? 'ğŸ™‚ï¼ˆä¹è§‚ï¼‰' : (si <= -30 ? 'â˜¹ï¸ï¼ˆæ‚²è§‚ï¼‰' : 'ğŸ˜ï¼ˆä¸­æ€§ï¼‰'); const roles = $json.roles || {}; return `ä»Šæ—¥å¸‚åœºæƒ…ç»ªï¼š${emoji}\n\nğŸ“¢ USIS Â· ä»Šæ—¥å››è§’è§‚ç‚¹\n\nğŸ§  Analystï¼š${roles.analyst || ''}\nğŸ—£ Commentatorï¼š${roles.commentator || ''}\nğŸ’¼ Traderï¼š${roles.trader || ''}\nğŸ“° Reporterï¼š${roles.reporter || ''}`; })() }}",
              "type": "string"
            },
            {
              "id": "id-2",
              "name": "mj_prompt",
              "value": "=Cinematic finance poster, macro mood board, minimalist, high contrast, headline in Chinese, four short blurbs: Analyst:={{ $json.roles.analyst }}; Commentator:={{ $json.roles.commentator }}; Trader:={{ $json.roles.trader }}; Reporter:={{ $json.roles.reporter }}; style: professional, infographic, 16:9",
              "type": "string"
            },
            {
              "id": "id-3",
              "name": "ratio",
              "value": "16:9",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "e8716939-73d9-471b-af9c-dd75e15d7679",
      "name": "E_PackRoleText",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -91712,
        1280
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://node-js-liqixi842.replit.app/img/imagine",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"prompt\": \"={{$json.mj_prompt || 'A cinematic finance poster, stock market, professional lighting'}}\",\n  \"mode\": \"fast\",\n  \"ratio\": \"={{$json.ratio || '16:9'}}\"\n}",
        "options": {
          "response": {
            "response": {
              "neverError": true
            }
          }
        }
      },
      "id": "f2fa64fa-0385-4b53-a0a7-8fab2ca84b36",
      "name": "E_Midjourney",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -91488,
        1280
      ]
    },
    {
      "parameters": {
        "jsCode": "const b = $json||{};\nlet url = b.image_url || b.url || b.result || (b.task?.images?.[0]) || (b.data?.images?.[0]) || (Array.isArray(b.images)? b.images[0] : \"\");\nconst caption = $('E_PackRoleText').first().json?.caption || b.caption || \"\";\nif(!url) url = \"https://picsum.photos/1200/675\"; // fallback\nreturn [{ json:{ image_url:url, caption } }];"
      },
      "id": "5178972f-61a8-4124-ad75-cbe8309c51de",
      "name": "E_PickImage",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -91264,
        1280
      ]
    },
    {
      "parameters": {
        "operation": "sendPhoto",
        "chatId": "=7561303850\n",
        "file": "={{ $json.image_url }}",
        "additionalFields": {
          "caption": "={{ $json.caption }}"
        }
      },
      "id": "02a0dc74-b5a8-4882-b3f3-2066d97b8763",
      "name": "E_TelegramPush",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -91040,
        1280
      ],
      "webhookId": "2d704a40-cf80-470d-bfbf-04c7ccebee53",
      "credentials": {
        "telegramApi": {
          "id": "q4nKZXgSOL95srYI",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "id-1",
              "name": "roles",
              "value": "={ \"analyst\": \"å®è§‚ä¸­æ€§åå¤š,å…³æ³¨ç¾å€ºä¸éå†œã€‚\", \"commentator\": \"æœºæ„å¢é…æƒé‡,ç§‘æŠ€åˆ†åŒ–ã€‚\", \"trader\": \"è½»ä»“é¡ºåŠ¿,å›æ’¤ä¸ç ´5æ—¥çº¿æŒæœ‰ã€‚\", \"reporter\": \"å¹¶è´­/ç›‘ç®¡/è´¢æŠ¥ä¸‰åˆ™è¦é—»ã€‚\" }",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "id": "0f14e1b0-ab69-4774-bfcd-16e7a7bfccc0",
      "name": "E_TestInput",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -91936,
        1376
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "id-1",
              "name": "q",
              "value": "(NVDA OR AAPL OR TSLA OR SP500 OR finance) lang:en -is:retweet",
              "type": "string"
            },
            {
              "id": "id-2",
              "name": "max_results",
              "value": 20,
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "id": "15d4d0af-2a13-49e0-9c0f-c1eefbfc49d5",
      "name": "T_Query",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -91616,
        496
      ]
    },
    {
      "parameters": {
        "url": "https://api.twitter.com/2/tweets/search/recent",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "query",
              "value": "={{ $json.q }}"
            },
            {
              "name": "tweet.fields",
              "value": "created_at,public_metrics,lang,author_id,source"
            },
            {
              "name": "max_results",
              "value": "={{ $json.max_results }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('Workflow Configuration').first().json.TWITTER_BEARER }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "neverError": true
            }
          }
        }
      },
      "id": "eac5f295-21f5-4732-beac-078364b72297",
      "name": "T_TwitterRecent",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -91392,
        496
      ]
    },
    {
      "parameters": {
        "jsCode": "const data = $json.tweets_scored || [];\nconst items = Array.isArray(data) ? data : [];\nconst top = items\n  .sort((a,b)=> (b.ret + b.fav) - (a.ret + a.fav))\n  .slice(0,5);\nreturn [{ json: { tweets: top, sentiment_index: $json.sentiment_index } }];"
      },
      "id": "72697e2c-50df-475f-90d0-77dce832b9a3",
      "name": "T_MapTweets",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -90944,
        496
      ]
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {
          "includeUnpaired": true
        }
      },
      "id": "9390520a-fe55-4b0b-a27a-6460031e3be8",
      "name": "C_T_Merge",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -90720,
        352
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "id-1",
              "name": "TWITTER_BEARER",
              "value": "AAAAAAAAAAAAAAAAAAAAAK1u5AEAAAAAwoluSa%2BRrMvg8adJIRMATbcwabA%3DlnKO8ZrohDTZG9l7e7VRaGTVsXqYykmrQ9L3093gZJrjdZwJFw",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "id": "202b4dc8-f30e-4321-98ee-18cbc1ae7c1b",
      "name": "Workflow Configuration",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -92288,
        352
      ]
    },
    {
      "parameters": {
        "jsCode": "// è¾“å…¥ï¼šæ¥è‡ª T_TwitterRecent çš„ { data: [...] }\nconst data = $json.data || [];\nconst items = Array.isArray(data) ? data : [];\n\n// âœ… æ›´ä¸°å¯Œçš„æƒ…ç»ªè¯åº“ï¼ˆåŒ…å«äº¤æ˜“åœˆå¸¸ç”¨è¯ + è¡¨æƒ…ç¬¦å·ï¼‰\nconst pos = [\n  /\\b(bullish|surge|rally|breakout|strong|gain|beat|upgrade|optimistic|pump|moon|green|rebound|recover|uptrend|buying|bull|positive|long|soar|skyrocket)\\b/i,\n  /ğŸš€|ğŸ”¥|ğŸ’ª|ğŸŸ¢|ğŸ’°|ğŸ†|ğŸ˜„|ğŸ˜|ğŸ˜/\n];\n\nconst neg = [\n  /\\b(bearish|plunge|crash|selloff|weak|drop|miss|downgrade|pessimistic|dump|red|downtrend|fall|bear|shorting|collapse|negative|panic|fear)\\b/i,\n  /ğŸ’€|ğŸ˜­|ğŸ˜¢|ğŸ”»|ğŸ˜¡|ğŸ˜|ğŸ˜©|ğŸ”´/\n];\n\n// âœ… å¯¹æ¯æ¡æ¨æ–‡è¿›è¡Œæ‰“åˆ†\nconst scored = items.map(t => {\n  const text = (t.text || \"\").toLowerCase();\n  let s = 0;\n\n  // åŒ¹é…æ­£é¢è¯\n  if (pos.some(r => r.test(text))) s += 1;\n\n  // åŒ¹é…è´Ÿé¢è¯\n  if (neg.some(r => r.test(text))) s -= 1;\n\n  return {\n    id: t.id,\n    text: t.text,\n    created_at: t.created_at,\n    score: s,\n    ret: t.public_metrics?.retweet_count || 0,\n    fav: t.public_metrics?.like_count || 0\n  };\n});\n\n// âœ… æ±‡æ€»æƒ…ç»ªï¼š[-1, 0, 1] å¹³å‡åæ˜ å°„åˆ° [-100..100]\nconst avg = scored.length\n  ? (scored.reduce((a, b) => a + b.score, 0) / scored.length)\n  : 0;\n\nconst sentiment_index = Math.max(-100, Math.min(100, Math.round(avg * 100)));\n\n// âœ… è¾“å‡ºç»“æœ\nreturn [{\n  json: {\n    tweets_raw: items,\n    tweets_scored: scored,\n    sentiment_index\n  }\n}];\n"
      },
      "id": "4ad80bbf-14f4-4135-9f3b-65e0edc757c3",
      "name": "T_Sentiment",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -91168,
        496
      ]
    },
    {
      "parameters": {
        "jsCode": "// è®¡ç®— 7 æ—¥æƒ…ç»ªè¶‹åŠ¿ - åŸºäºæ–œç‡çš„è®¡ç®—é€»è¾‘\nconst input = $input.first().json;\nconst historyRaw = input.sentiment_history || [];\nconst items = Array.isArray(historyRaw) ? historyRaw : [];\n\nif (items.length === 0) {\n  return [{\n    json: {\n      trend_text: 'æš‚æ— å†å²æ•°æ®âš–ï¸',\n      labelsCSV: '',\n      dataCSV: '',\n      priceCSV: '',\n      avg_sentiment: 0\n    }\n  }];\n}\n\n// æå–å¹¶æ’åºæ—¥æœŸ-å€¼å¯¹\nconst pairs = items\n  .map(record => ({\n    date: record.date || '',\n    value: record.sentiment_index || 0,\n    price: record.price || 0\n  }))\n  .filter(p => p.date)\n  .sort((a, b) => a.date.localeCompare(b.date));\n\nif (pairs.length === 0) {\n  return [{\n    json: {\n      trend_text: 'æš‚æ— æœ‰æ•ˆæ•°æ®âš–ï¸',\n      labelsCSV: '',\n      dataCSV: '',\n      priceCSV: '',\n      avg_sentiment: 0\n    }\n  }];\n}\n\n// ç”Ÿæˆæ ‡ç­¾ï¼ˆMM-DD æ ¼å¼ï¼‰å’Œå€¼ï¼ˆå½’ä¸€åŒ–åˆ° -1 åˆ° 1ï¼‰\nconst labels = pairs.map(p => {\n  const parts = p.date.split('-');\n  return parts.length >= 3 ? `${parts[1]}-${parts[2]}` : p.date;\n});\n\nconst values = pairs.map(p => {\n  const normalized = p.value / 100; // å‡è®¾åŸå§‹å€¼åœ¨ -100 åˆ° 100 èŒƒå›´\n  return Math.max(-1, Math.min(1, normalized));\n});\n\n// æå–ä»·æ ¼æ•°æ®\nconst prices = pairs.map(p => p.price);\n\n// è®¡ç®—æ–œç‡\nconst count = values.length;\nconst slope = count > 1 ? (values[count - 1] - values[0]) / (count - 1) : 0;\n\n// æ ¹æ®æ–œç‡åˆ¤æ–­è¶‹åŠ¿\nlet trend_text;\nif (slope > 0.02) {\n  trend_text = 'å¸‚åœºæƒ…ç»ªæŒç»­å›æš–ğŸ“ˆ';\n} else if (slope < -0.02) {\n  trend_text = 'å¸‚åœºæƒ…ç»ªç•¥æ˜¾è°¨æ…ğŸ“‰';\n} else {\n  trend_text = 'å¸‚åœºæƒ…ç»ªä¿æŒå¹³ç¨³âš–ï¸';\n}\n\n// ç”Ÿæˆ CSV æ ¼å¼\nconst labelsCSV = labels.map(l => `\"${l}\"`).join(',');\nconst dataCSV = values.map(v => v.toFixed(3)).join(',');\nconst priceCSV = prices.map(p => p.toFixed(2)).join(',');\n\n// è®¡ç®—å¹³å‡æƒ…ç»ª\nconst avg = pairs.reduce((sum, p) => sum + p.value, 0) / pairs.length;\n\nreturn [{\n  json: {\n    trend_text,\n    labelsCSV,\n    dataCSV,\n    priceCSV,\n    avg_sentiment: Math.round(avg)\n  }\n}];"
      },
      "id": "f50c4616-9e14-42f3-8da5-2ebf15b2b5fd",
      "name": "F_Calc_Trend",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -89376,
        352
      ]
    },
    {
      "parameters": {
        "url": "=https://quickchart.io/chart?w=900&h=400&c={type:'line',data:{labels:[{{ $json.labelsCSV }}],datasets:[{label:'Sentiment',data:[{{ $json.dataCSV }}]}]},options:{plugins:{title:{display:true,text:'7-Day Sentiment Trend'}},scales:{y:{min:-1,max:1}}}}",
        "options": {
          "response": {
            "response": {}
          }
        }
      },
      "id": "089ae999-435f-44bf-be63-f6afd164eaac",
      "name": "F_Draw_Chart",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -92512,
        960
      ]
    },
    {
      "parameters": {
        "operation": "sendDocument",
        "chatId": "7561303850",
        "binaryData": true,
        "binaryPropertyName": "chart",
        "additionalFields": {
          "caption": "=ğŸ§­ 7å¤©æƒ…ç»ªè¶‹åŠ¿åˆ†æ\n\n{{ $node[\"F_Calc_Trend\"].json[\"trend_text\"] }}\nğŸ’° æœ€æ–°ä»·æ ¼: {{ $node[\"C_Map_Quote\"].json[\"price\"] ?? $node[\"F_Collect_History1\"].json[\"price\"] ?? \"N/A\" }}\n\nğŸ“Š æœ€æ–°æƒ…ç»ªæŒ‡æ•°: {{ $node[\"F_Collect_History1\"].json[\"sentiment_index\"] }}\nğŸ“ˆ 7æ—¥å¹³å‡: {{ $node[\"F_Calc_Trend\"].json[\"avg_sentiment\"] }}\nâ° æ›´æ–°æ—¶é—´: {{ $now.format(\"yyyy-MM-dd HH:mm\") }}\nğŸ§  AI è§£è¯»ï¼š{{ $node[\"AI_Summary_Chain\"].json[\"text\"] }}",
          "fileName": "sentiment_price.png"
        }
      },
      "id": "74989288-a2d1-4930-8099-c8c117f56c54",
      "name": "F_Send_Chart",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -88352,
        512
      ],
      "webhookId": "5db21430-ee2f-4b1e-899a-a42ae1060d76",
      "credentials": {
        "telegramApi": {
          "id": "q4nKZXgSOL95srYI",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "id-1",
              "name": "chart_url",
              "value": "={{ (() => { const labels = ($json.labelsCSV || '').split(',').map(l => l.replace(/\"/g, '').trim()); const sentimentData = ($json.dataCSV || '').split(',').map(v => parseFloat(v.trim())); const priceData = ($json.priceCSV || '').split(',').map(v => parseFloat(v.trim())); const chartConfig = { type: 'line', data: { labels: labels, datasets: [{ label: 'Sentiment', data: sentimentData, borderColor: 'rgb(75, 192, 192)', tension: 0.1, yAxisID: 'y' }, { label: 'Price', data: priceData, borderColor: 'rgb(255, 99, 132)', tension: 0.1, yAxisID: 'y1' }] }, options: { plugins: { title: { display: true, text: 'Sentiment vs Price (7-Day Trend)' } }, scales: { y: { type: 'linear', display: true, position: 'left', min: -1, max: 1, title: { display: true, text: 'Sentiment' } }, y1: { type: 'linear', display: true, position: 'right', title: { display: true, text: 'Price' }, grid: { drawOnChartArea: false } } } } }; return 'https://quickchart.io/chart.png?w=900&h=400&c=' + encodeURIComponent(JSON.stringify(chartConfig)); })() }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "6cb3373e-bd68-46a4-ae4f-346a5c492a31",
      "name": "F_BuildChartUrl",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -89088,
        512
      ]
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "mode": "url",
          "value": "https://docs.google.com/spreadsheets/d/1z5okdHtVTehghIZYaj78ZwMCO49L-rHPV8cWFgwArAA/edit?gid=0#gid=0"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "å·¥ä½œè¡¨1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1z5okdHtVTehghIZYaj78ZwMCO49L-rHPV8cWFgwArAA/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "date": "={{ $json.date }}",
            "sentiment_index": "={{ $json.sentiment_index }}",
            "price": "={{ $json.price }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "date",
              "displayName": "date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "sentiment_index",
              "displayName": "sentiment_index",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "price",
              "displayName": "price",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "5dd41265-57dd-4632-a897-7e51be3e20f7",
      "name": "F_Write_Today",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -90048,
        352
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "6WKi5SVIzdnv6KX3",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// æ—¥æœŸï¼šYYYY-MM-DD\nconst date = new Date().toISOString().slice(0, 10);\n\n// å…ˆå°è¯•ä»è¾“å…¥æ‹¿ï¼ˆå¦‚æœä¸Šæ¸¸ä¼ è¿‡æ¥å°±ç”¨ï¼‰\nlet si = $input.first()?.json?.sentiment_index;\n\n// å¦‚æœè¾“å…¥é‡Œæ²¡æœ‰ï¼Œå°±ä»ä¸Šæ¸¸èŠ‚ç‚¹ç›´æ¥è¯»å–ï¼ˆè¿™ä¸¤ä¸ªèŠ‚ç‚¹ä¸€å®šæœ‰ï¼‰\nif (si === undefined) {\n  si = $node[\"T_MapTweets\"].json?.sentiment_index\n    ?? $node[\"T_Sentiment\"].json?.sentiment_index\n    ?? 0;\n}\n\nreturn [{\n  json: {\n    date,\n    sentiment_index: Number(si)\n  }\n}];\n"
      },
      "id": "3b974da2-497e-43c3-8232-ba5e271a77b5",
      "name": "F_Collect_History1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -90272,
        352
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "url",
          "value": "https://docs.google.com/spreadsheets/d/1z5okdHtVTehghIZYaj78ZwMCO49L-rHPV8cWFgwArAA/edit"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "å·¥ä½œè¡¨1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1z5okdHtVTehghIZYaj78ZwMCO49L-rHPV8cWFgwArAA/edit#gid=0"
        },
        "options": {
          "dataLocationOnSheet": {
            "values": {
              "rangeDefinition": "detectAutomatically"
            }
          }
        }
      },
      "id": "0de7991d-ce2f-4975-ad3d-63322c7f0477",
      "name": "F_Read_7Days",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -89824,
        352
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "6WKi5SVIzdnv6KX3",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ä»æ‰€æœ‰è¾“å…¥é¡¹ä¸­æå– date, sentiment_index, price\nconst allData = $input.all()\n  .map(item => ({\n    date: item.json.date,\n    sentiment_index: Number(item.json.sentiment_index) || 0,\n    price: Number(item.json.price) || 0\n  }))\n  .filter(record => record.date)  // è¿‡æ»¤æ‰æ²¡æœ‰æ—¥æœŸçš„è®°å½•\n  .sort((a, b) => a.date.localeCompare(b.date));  // æŒ‰æ—¥æœŸå‡åºæ’åº\n\n// åªä¿ç•™æœ€å 7 æ¡è®°å½•\nconst last7 = allData.slice(-7);\n\n// è¾“å‡ºæ ¼å¼\nreturn [{\n  json: {\n    sentiment_history: last7\n  }\n}];"
      },
      "id": "2b632d61-b979-46a1-89a5-24a413663750",
      "name": "F_Transform_History",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -89600,
        352
      ]
    },
    {
      "parameters": {
        "jsCode": "// è·å–ä»Šå¤©çš„æ—¥æœŸï¼ˆæ ¼å¼ YYYY-MM-DDï¼‰\nconst date = new Date().toISOString().slice(0, 10);\n\n// è¯»å–æƒ…ç»ªæŒ‡æ•°ï¼ˆä¼˜å…ˆä»è¾“å…¥æ‹¿ï¼Œæ²¡æœ‰å°±ä»ä¸Šæ¸¸èŠ‚ç‚¹è¯»å–ï¼‰\nlet sentiment_index = $input.first()?.json?.sentiment_index;\n\nif (sentiment_index === undefined) {\n  sentiment_index = $node['T_MapTweets']?.json?.sentiment_index\n    ?? $node['T_Sentiment']?.json?.sentiment_index\n    ?? 0;\n}\n\n// ä» C_Map_Quote èŠ‚ç‚¹è¯»å–å½“å‰ä»·æ ¼\nconst price = $node['C_Map_Quote']?.json?.price ?? 0;\n\n// è¾“å‡ºæ ¼å¼\nreturn [{\n  json: {\n    date: date,\n    sentiment_index: Number(sentiment_index),\n    price: Number(price)\n  }\n}];"
      },
      "id": "a22c44b5-b0d3-44d7-8509-8d4f3bfdf487",
      "name": "F_Collect_History1ï¼ˆæ–°ç‰ˆï¼‰",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -92512,
        736
      ]
    },
    {
      "parameters": {
        "url": "={{ $json.chart_url }}",
        "options": {
          "response": {
            "response": {
              "neverError": true,
              "responseFormat": "file",
              "outputPropertyName": "chart"
            }
          }
        }
      },
      "id": "81f7fee7-c2c3-4a30-bb8a-cdcf221cdc90",
      "name": "F_Download_Chart",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -88800,
        512
      ]
    },
    {
      "parameters": {
        "jsCode": "// Extract AI summary text from chain output\nconst ai_summary = $json.output || $json.ai_summary || \"\";\n\nreturn [{\n  json: {\n    ai_summary: ai_summary\n  }\n}];"
      },
      "id": "5b487f9d-0b0f-41fe-b774-3a98e673b62a",
      "name": "F_Extract_AI_Summary",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -88800,
        0
      ]
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {
          "temperature": 0.6
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -89088,
        320
      ],
      "id": "26dbe073-76c5-42cf-91dd-69c8c9ace638",
      "name": "F_AI_Summary1",
      "credentials": {
        "openAiApi": {
          "id": "kCv97lI74mm9IFic",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„å¸‚åœºåˆ†æå¸ˆï¼Œè¯·ç”¨ç®€çŸ­è‡ªç„¶çš„ä¸­æ–‡å†™å‡ºå¸‚åœºæ•´ä½“æƒ…ç»ªä¸èµ°åŠ¿æ€»ç»“ã€‚\nä»Šæ—¥æƒ…ç»ªæŒ‡æ•°ï¼š={{ $json.sentiment_index }}\nä»Šæ—¥ä»·æ ¼ï¼š={{ $json.price }}\nä¸ƒæ—¥å¹³å‡æƒ…ç»ªï¼š={{ $node[\"F_Calc_Trend\"].json[\"avg_sentiment\"] }}\nè¶‹åŠ¿åˆ¤æ–­ï¼š={{ $node[\"F_Calc_Trend\"].json[\"trend_text\"] }}",
        "batching": {}
      },
      "id": "faad1d01-4e3c-4fa0-b808-b9cb01b9931c",
      "name": "AI_Summary_Chain",
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        -89152,
        96
      ]
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {
          "includeUnpaired": true
        }
      },
      "id": "0e5c18a2-9294-429e-ad4d-7044f2194dd7",
      "name": "F_Merge_Chart_AI",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -88576,
        448
      ]
    },
    {
      "parameters": {
        "resource": "conversation",
        "messages": {
          "values": [
            {
              "role": "system",
              "content": "You are a professional market analyst. Write a clear, concise (<400 Chinese characters) daily report in Chinese. No disclaimers.\n"
            },
            {
              "content": "=è¯·åŸºäºä»¥ä¸‹å˜é‡è¾“å‡ºä¸€ä»½<400å­—çš„ä¸­æ–‡æ—¥æŠ¥>ï¼š\nä»Šæ—¥æƒ…ç»ªæŒ‡æ•°ï¼š{{$node[\"F_Collect_History1\"].json[\"sentiment_index\"] || \"N/A\"}}\nä¸ƒæ—¥å‡å€¼ï¼š{{$node[\"F_Calc_Trend\"].json[\"avg_sentiment\"] || \"N/A\"}}\nè¶‹åŠ¿åˆ¤æ–­ï¼š{{$node[\"F_Calc_Trend\"].json[\"trend_text\"] || \"N/A\"}}\nä»·æ ¼ï¼š{{$node[\"C_Map_Quote\"].json[\"price\"] || \"N/A\"}}\nAIè¦ç‚¹ï¼š{{$node[\"AI_Summary_Chain\"].json[\"text\"] || \"N/A\"}}\nå¤´æ¡ï¼š{{$node[\"C_Map_News\"].json[\"top_headlines\"] || \"N/A\"}}\nè¾“å‡ºç»“æ„ï¼šâ‘ æ€»ä½“æƒ…ç»ªä¸è¶‹åŠ¿ â‘¡ä»·æ ¼æ¦‚å†µ â‘¢è¦ç‚¹æ€»ç»“(â‰¤3æ¡) â‘£å¤´æ¡(æœ€å¤š2æ¡ï¼Œå«æ¥æº)ã€‚\n"
            }
          ]
        },
        "options": {
          "metadata": "{\n  \"model\": \"gpt-4o-mini\",\n  \"temperature\": \"0.4\",\n  \"simplify\": \"true\"\n}\n"
        }
      },
      "id": "b199e614-141f-41cb-92c0-e2f2eed958cc",
      "name": "H_Build_Report",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 2,
      "position": [
        -88800,
        192
      ],
      "credentials": {
        "openAiApi": {
          "id": "kCv97lI74mm9IFic",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "id-1",
              "name": "caption",
              "value": "=ğŸ§¾ Auto Report Â· USIS\n[ZH] {{ $json.report_zh }}\nâ€”â€”\n[ES] {{ $json.report_es }}\nâ€”â€”\n[EN] {{ $json.report_en }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "id": "6fa8c230-a6e8-4124-8813-079bbb95d4b6",
      "name": "H_Pack",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -87904,
        192
      ]
    },
    {
      "parameters": {
        "operation": "sendDocument",
        "chatId": "7561303850",
        "binaryData": true,
        "binaryPropertyName": "chart",
        "additionalFields": {
          "caption": "={{ $json.caption }}",
          "fileName": "usis_report.png"
        }
      },
      "id": "353b2fcd-9cba-44b1-9993-c2580e109e87",
      "name": "H_Send_Report",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -87680,
        192
      ],
      "webhookId": "57a8db8f-4a7a-476c-858a-e049539e1061",
      "credentials": {
        "telegramApi": {
          "id": "q4nKZXgSOL95srYI",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "resource": "conversation",
        "messages": {
          "values": [
            {
              "role": "system",
              "content": "You are a senior financial translator. Keep meaning, be concise and idiomatic. No disclaimers.\n"
            },
            {
              "content": "=Source (ZH):\n{{ \n  (() => {\n    const n = $node[\"H_Build_Report\"].json || {};\n    const fromOutput = n?.output?.[0]?.content?.[0]?.text;\n    const fromMsgArr = Array.isArray(n?.messages)\n      ? n.messages.filter(m => (m.role || '').toLowerCase() === 'assistant').slice(-1)[0]?.content\n      : undefined;\n    return fromOutput || fromMsgArr || n?.response || n?.text || 'N/A';\n  })()\n}}\n\nTranslate into Spanish and English.\nReturn PLAIN TEXT only, exactly in three tagged sections:\n<ZH>Chinese (lightly polished)</ZH>\n<ES>Natural Spanish</ES>\n<EN>Natural English</EN>\nNo markdown, no code fences, no extra lines before/after, no commentary.\n"
            }
          ]
        },
        "options": {
          "metadata": "{\n  \"model\": \"gpt-4o-mini\",\n  \"temperature\": \"0.2\",\n  \"simplify\": \"false\"\n}\n"
        }
      },
      "id": "b0f11dba-da8f-4efa-b84b-e776c6c6e78d",
      "name": "H_Localize",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 2,
      "position": [
        -88576,
        192
      ],
      "credentials": {
        "openAiApi": {
          "id": "kCv97lI74mm9IFic",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// è¯»å– n8n Conversation ç±»å‹èŠ‚ç‚¹è¾“å‡º\nlet txt = '';\n\n// å°è¯•ä»æ–°ç‰ˆ Conversation è¾“å‡ºè¯»å–ï¼ˆä¼˜å…ˆ outputï¼‰\nif ($json.output && Array.isArray($json.output)) {\n  txt = $json.output.map(o =>\n    o?.content?.map(c => c?.text || c?.content || '').join('\\n')\n  ).join('\\n');\n}\n\n// å¦‚æœ output ä¸ºç©ºï¼Œåˆ™ä» messages è¯»å–\nif (!txt && Array.isArray($json.messages)) {\n  const assistantMsg = $json.messages.filter(m => m.role === 'assistant');\n  if (assistantMsg.length) {\n    const content = assistantMsg[assistantMsg.length - 1].content;\n    txt = Array.isArray(content)\n      ? content.map(c => c.text || c.content || '').join('\\n')\n      : content || '';\n  }\n}\n\n// å…œåº•è¯»å–æ—§å­—æ®µ\nif (!txt) {\n  txt = $json.response || $json.text || '';\n}\n\n// æ­£åˆ™æå– <ZH>/<ES>/<EN>\nfunction section(tag) {\n  const re = new RegExp(`<${tag}>[\\\\s\\\\S]*?<\\\\/${tag}>`, 'i');\n  const m = txt.match(re);\n  return m ? m[0].replace(new RegExp(`</?${tag}>`, 'ig'), '').trim() : 'N/A';\n}\n\nreturn [{\n  report_zh: section('ZH'),\n  report_es: section('ES'),\n  report_en: section('EN'),\n  raw_text: txt\n}];\n"
      },
      "id": "332bd4bc-b299-4320-b197-9aae57dc0833",
      "name": "H_Split_Localize",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -88352,
        192
      ]
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {
          "includeUnpaired": true
        }
      },
      "id": "2ebbce0f-61ec-4089-88e1-244085481416",
      "name": "H_Merge_ReportChart",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -88128,
        192
      ]
    }
  ],
  "pinData": {},
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Workflow Configuration",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "C_Quote_AVDemo": {
      "main": [
        [
          {
            "node": "C_Map_Quote",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "C_Map_Quote": {
      "main": [
        [
          {
            "node": "C_RSS_News",
            "type": "main",
            "index": 0
          },
          {
            "node": "C_Merge_QuoteNews",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "C_RSS_News": {
      "main": [
        [
          {
            "node": "C_Convert_RSS_JSON",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "C_Convert_RSS_JSON": {
      "main": [
        [
          {
            "node": "C_Map_News",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "C_Map_News": {
      "main": [
        [
          {
            "node": "C_Merge_QuoteNews",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "C_Merge_QuoteNews": {
      "main": [
        [
          {
            "node": "C_T_Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "D_RoleRouter": {
      "main": [
        [
          {
            "node": "D_ParseRoleOutput",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Start_D_from_B": {
      "main": [
        [
          {
            "node": "D_RoleRouter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "D_ParseRoleOutput": {
      "main": [
        [
          {
            "node": "E_PackRoleText",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "E_PackRoleText": {
      "main": [
        [
          {
            "node": "E_Midjourney",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "E_Midjourney": {
      "main": [
        [
          {
            "node": "E_PickImage",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "E_PickImage": {
      "main": [
        [
          {
            "node": "E_TelegramPush",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "E_TestInput": {
      "main": [
        [
          {
            "node": "E_PackRoleText",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "T_MapTweets": {
      "main": [
        [
          {
            "node": "C_T_Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "C_T_Merge": {
      "main": [
        [
          {
            "node": "C_Post_BrainFeed",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Workflow Configuration": {
      "main": [
        [
          {
            "node": "C_Quote_AVDemo",
            "type": "main",
            "index": 0
          },
          {
            "node": "T_Query",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "T_Query": {
      "main": [
        [
          {
            "node": "T_TwitterRecent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "T_TwitterRecent": {
      "main": [
        [
          {
            "node": "T_Sentiment",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "T_Sentiment": {
      "main": [
        [
          {
            "node": "T_MapTweets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "C_Post_BrainFeed": {
      "main": [
        [
          {
            "node": "F_Collect_History1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "F_Calc_Trend": {
      "main": [
        [
          {
            "node": "F_BuildChartUrl",
            "type": "main",
            "index": 0
          },
          {
            "node": "AI_Summary_Chain",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "F_BuildChartUrl": {
      "main": [
        [
          {
            "node": "F_Download_Chart",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "F_Collect_History1": {
      "main": [
        [
          {
            "node": "F_Write_Today",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "F_Write_Today": {
      "main": [
        [
          {
            "node": "F_Read_7Days",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "F_Read_7Days": {
      "main": [
        [
          {
            "node": "F_Transform_History",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "F_Transform_History": {
      "main": [
        [
          {
            "node": "F_Calc_Trend",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "F_AI_Summary1": {
      "ai_languageModel": [
        [
          {
            "node": "AI_Summary_Chain",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI_Summary_Chain": {
      "main": [
        [
          {
            "node": "F_Extract_AI_Summary",
            "type": "main",
            "index": 0
          },
          {
            "node": "F_Merge_Chart_AI",
            "type": "main",
            "index": 1
          },
          {
            "node": "H_Build_Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "F_Download_Chart": {
      "main": [
        [
          {
            "node": "F_Merge_Chart_AI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "F_Merge_Chart_AI": {
      "main": [
        [
          {
            "node": "F_Send_Chart",
            "type": "main",
            "index": 0
          },
          {
            "node": "H_Merge_ReportChart",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "H_Build_Report": {
      "main": [
        [
          {
            "node": "H_Localize",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "H_Localize": {
      "main": [
        [
          {
            "node": "H_Split_Localize",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "H_Pack": {
      "main": [
        [
          {
            "node": "H_Send_Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "H_Split_Localize": {
      "main": [
        [
          {
            "node": "H_Merge_ReportChart",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "H_Merge_ReportChart": {
      "main": [
        [
          {
            "node": "H_Pack",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "8cf359c4-bc60-4add-ba0e-e795e4907f08",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "e55566bfe54f88b404d502841707ce3b88351798d04a45b88b4e50f6ca391fb1"
  },
  "id": "SaNOJVcdOvaPP4Vh",
  "tags": [
    {
      "updatedAt": "2025-11-02T08:51:32.411Z",
      "createdAt": "2025-11-02T08:51:32.411Z",
      "id": "A6nE3jj94VgdNNeJ",
      "name": "USIS_DataEmpire_CDE_Fina"
    }
  ]
}