给 Replit 的执行指令（复制粘贴）

【第1步｜统一模型】

# 替换所有 gpt-4o-mini 为 gpt-5-turbo
grep -Rsn "gpt-4o-mini" .
# 若有命中，统一替换为 gpt-5-turbo（先备份）
cp gpt5Brain.js gpt5Brain.js.bak 2>/dev/null || true
sed -i 's/gpt-4o-mini/gpt-5-turbo/g' gpt5Brain.js

# 若代码里还有 gpt-5-single 或其他占位，也统一成 gpt-5-turbo
sed -i 's/gpt-5-single/gpt-5-turbo/g' gpt5Brain.js


【第2步｜确保请求超时与错误兜底】（只改路由外层，不动业务逻辑）

// index.js 中 /brain/orchestrate 路由外层应保留 try/catch（已存在可跳过）
app.post('/brain/orchestrate', async (req, res) => {
  const started = Date.now();
  try {
    // ... 原有逻辑
    // 建议把当前使用模型回传，便于n8n侧观测
    const payload = { status:'ok', model:'gpt-5-turbo', final_text, actions, symbols:[], elapsed_ms: Date.now()-started };
    return res.status(200).json(payload);
  } catch (err) {
    console.error('[orchestrate] error', err);
    return res.status(200).json({ status:'error', error:String(err?.message||err), final_text:'（临时故障，请稍后再试）', actions:[], symbols:[] });
  }
});


【第3步｜重启并自测】

pkill -f "node index.js" 2>/dev/null || true
node index.js > /tmp/usis.log 2>&1 & sleep 3

# 健康检查
curl -s https://node-js-liqixi842.replit.app/health | jq

# Ping 自检
curl -s -X POST https://node-js-liqixi842.replit.app/brain/ping \
 -H "Content-Type: application/json" -d '{"hello":"world"}' | jq

# 主路由验证（应看到 model:"gpt-5-turbo"）
curl -s -X POST https://node-js-liqixi842.replit.app/brain/orchestrate \
 -H "Content-Type: application/json" \
 -d '{"text":"测试GPT-5路由","user_id":"debug","mode":"ping","chat_type":"private","budget":"low"}' | jq


【第4步｜接回 n8n】
n8n 的 HTTP 请求节点 Call_Brain_Orchestrate 仍然 POST 到
/brain/orchestrate 并携带 text / chat_type / user_id / mode / budget 五个字段，无需改动

Telegram to Replit Brain Messag…

。
n8n 的 Normalize_Brain_Response / IF_ErrorCheck 会吃 status:"ok" 或 error 的统一结构，也无需改动

Telegram to Replit Brain Messag…

。

快速验收标准（今天就能用）

/brain/orchestrate 返回 JSON 中 model 字段为 "gpt-5-turbo"（且 status:"ok"）。

Telegram 发消息能直接收到群聊风格结果（n8n 透传字段不变

Telegram to Replit Brain Messag…

）。

若 Replit 执行完，回我三行输出即可：

grep -Rsn "gpt-5-turbo" gpt5Brain.js 的命中行

/brain/orchestrate 的完整响应（含 model）

如有报错贴出 /tmp/usis.log 尾部 50 行

我据此再做最后一轮校准，马上让它在群里跑起来。