现在 v5 英文报告在 Phase 2.6（Technical Indicators Table & Commentary）报错：

❌ [buildResearchReport] Error: Cannot read properties of undefined (reading 'toFixed')

说明在 generateTechnicalIndicatorsData 里，有对 undefined 调用了 .toFixed()，例如 techData.rsi_14 / macd / ema_20 / bb_upper / bb_lower / support_level / resistance_level 等。

请做一个防御性修复，让任何技术指标缺失时不会抛异常，而是显示 "N/A" 或安全值。

【STEP 1】在 reportService.js 中找到 generateTechnicalIndicatorsData 函数（你刚才新增的那段），定位所有 .toFixed() 的使用。

大概类似：

  const rsi = techData.rsi_14.toFixed(2);
  const macd = techData.macd.toFixed(4);
  const ema20 = techData.ema_20.toFixed(2);
  const bbUpper = techData.bb_upper.toFixed(2);
  const bbLower = techData.bb_lower.toFixed(2);
  const support = report.techs.support_level.toFixed(2);
  const resistance = report.techs.resistance_level.toFixed(2);

【STEP 2】改成带类型检查的安全写法，例如：

  function safeToFixed(value, digits = 2) {
    return (typeof value === 'number' && isFinite(value))
      ? value.toFixed(digits)
      : 'N/A';
  }

然后在 generateTechnicalIndicatorsData 里改为：

  const rsi = safeToFixed(techData.rsi_14, 2);
  const macd = safeToFixed(techData.macd, 4);
  const ema20 = safeToFixed(techData.ema_20, 2);
  const ema50 = safeToFixed(techData.ema_50, 2);
  const bbUpper = safeToFixed(techData.bb_upper, 2);
  const bbLower = safeToFixed(techData.bb_lower, 2);
  const support = safeToFixed(report.techs?.support_level, 2);
  const resistance = safeToFixed(report.techs?.resistance_level, 2);

并在 Signal 的判断里，遇到 "N/A" 时，返回 "Data unavailable" 或 "No signal"。

【STEP 3】在 buildResearchReport 中把错误打印完整 stack，方便以后排查：

  } catch (err) {
    console.error('[buildResearchReport] Error:', err.message);
    console.error(err.stack);
    // 保持原有 fallback 行为
  }

【STEP 4】本地测试一次：

  node -e "const { buildResearchReport } = require('./v3_dev/services/reportService'); (async () => { const t0 = Date.now(); const r = await buildResearchReport('NVDA', 'equity'); console.log('DONE in', Date.now()-t0, 'ms'); console.log('Thesis length:', (r.investment_thesis || '').length); })();"

确认：
- 不再出现 “Cannot read properties of undefined (reading 'toFixed')”
- 即使 techData 某些字段是 undefined，报告仍然能正常生成（表格里显示 N/A）

【STEP 5】再启动服务器，调用：

  curl -I "http://0.0.0.0:3000/v3/report/NVDA?format=json"

确认 HTTP 200，并在日志中看到 Technical Indicators Table 正常生成。

修完后，请打印一行确认：

  console.log('[TECH_TO_FIXED_PATCH_OK] Technical indicators safe formatting enabled');
