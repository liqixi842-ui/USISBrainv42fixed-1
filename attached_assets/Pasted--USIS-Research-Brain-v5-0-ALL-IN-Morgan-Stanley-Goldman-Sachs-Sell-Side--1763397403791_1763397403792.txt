现在执行 USIS Research Brain v5.0（ALL-IN 全启动）。

目标：构建 Morgan Stanley / Goldman Sachs 等级的 Sell-Side 研究大脑，包含四大部分：
A）机构级写作风格引擎（SellSideWriter v3）
B）Risk/Catalyst 完整性校正与量化补全（RiskCatalystEngine v2）
C）多研报类型扩展（单股/行业/ETF/月报）
D）生产部署准备（Reserved VM-ready）

你要创建新的 v5 目录：
v3_dev/services/v5/

结构如下：
v3_dev/services/v5/
 ├─ styleEngine.js             （机构级语气/句式/风格过滤）
 ├─ coherenceEngine.js         （语义一致性、衔接、段落逻辑）
 ├─ sentenceEngine.js          （断句修复、句式多样性、AI去味）
 ├─ riskCatalystEngine.js      （风险/催化剂自动补全/量化/清理）
 ├─ writerStockV3.js           （个股 Sell-Side Writer v3）
 ├─ writerIndustryV3.js        （行业深度 v3）
 ├─ writerMacroV3.js           （宏观/ETF/Index v3）
 └─ reportBuilderV5.js         （统一 orchestrator，替代 v2/v3）

============================
【PART 1 — 写作引擎（最关键）】
============================

创建 v3_dev/services/v5/styleEngine.js：
负责生成 Morgan Stanley / Goldman Sachs 级语气，包括：
- conditional phrasing（we believe / we note / our view）
- sell-side disclaimers
- structured professional tone
- zero-AI flavour
- natural transitions（moreover / in addition / however / going forward）
- sell-side vocabulary injection（margin compression / execution risk / capital allocation）

导出 styleEngine.applyStyle(text)。

创建 sentenceEngine.js：
- 修复 `. supported` / `. driven` / `. fueled` / `. coupled` 等断句
- 添加句式多样性（避免重复 patterns）
- 自动首字母大写
- 去AI味
- 去模板化句子

导出 sentenceEngine.normalize(text)。

创建 coherenceEngine.js：
- 保证段落之间衔接（coherence / transitions）
- 去掉重复信息（similarity > 0.4）
- 把 Thesis / Overview / Valuation / Macro / Industry 变成不同角度的文本（避免重复）

导出 coherenceEngine.rewriteSections(report)。

============================
【PART 2 — Risk / Catalyst Engine v2】
============================

创建 riskCatalystEngine.js：
功能：
1）自动删除垃圾项（Additional factor / placeholder）
2）断句修复
3）句子补全：
   - If missing number → call GPT mini to fill a realistic number
   - If missing timeframe → add "over the next 6–12 months"
   - If missing subject → inject company name
4）量化增强：
   - "could increase margin" → "could increase EBITDA margin by 80–120bps"
   - "market share gain" → "potential 2–4pt share gain"
5）结构化输出 6–8 条项

============================
【PART 3 — SellSideWriter v3（核心）】
============================

创建 writerStockV3.js：
由以下 5 引擎组成：
- ThesisEngine（800–900字）
- OverviewEngine（900字，Segment Breakdown）
- ValuationEngine（DCF / Multiples / Scenario）
- IndustryEngine（AI / Gaming / Cloud / Edge）
- MacroEngine（rates / liquidity / policy）

每段输出：
- 最少 600 字
- 分 2–3 subheaders
- 无重复
- 机构级词汇

每段处理顺序：
raw → cleaned → styled → sentenceEngine.normalize → coherenceEngine integration

============================
【PART 4 — 多研报类型】
============================

创建 writerIndustryV3.js：
行业深度 1200 字：
- TAM
- Market Structure
- Competitor Framework
- Key catalysts
- Valuation anchors

writerMacroV3.js：
- 月度市场策略（月报）
- 全球 ETF / Index 报告
- 交叉资产 flows / liquidity / FX sensitivity

============================
【PART 5 — reportBuilderV5.js】
============================

新建 reportBuilderV5.js：
负责 orchestrate 整个 pipeline，替代 v3 的 SellSideWriter v2。

流程：
1）FinancialDataBroker → 获取全套数据
2）ChartsEngine → 图表
3）writerStockV3 → 生成所有文本增强内容
4）RiskCatalystEngine → 清理/量化/补全
5）styleEngine.applyStyle → 机构语气
6）sentenceEngine.normalize → 句式修正
7）coherenceEngine.rewriteSections → 避免重复
8）映射字段：
   - investment_thesis
   - company_overview
   - valuation_text
   - industry_text
   - macro_text
   - catalysts_text[]
   - risks_text[]

9）TasteTruthLayer 跳过所有 v5 字段
10）交给 HTML 渲染（renderPage3–7）

============================
【PART 6 — 接入】
============================

在 reportService.js：
- 移除 SellSideWriter v1/v2
- 引入 reportBuilderV5
- 用 reportBuilderV5 生成最终 report 内容
- 保留技术指标 / 图表 / layout，不动其他模块

完成后打印：
"USIS Research Brain v5.0 — ALL-IN ACTIVATED"

不要部分执行，不要中途停止，必须完整建立 v5 结构。
