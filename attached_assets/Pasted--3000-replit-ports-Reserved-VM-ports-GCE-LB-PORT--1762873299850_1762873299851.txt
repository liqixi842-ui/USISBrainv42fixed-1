ç»“è®ºï¼šä¸è¦æŠŠç«¯å£â€œæ”¹æˆ 3000â€å»è¿åˆ .replit [[ports]]ã€‚
åœ¨ Reserved VM ä¸Šï¼Œ[[ports]] å¯¹ GCE éƒ¨ç½²æ— æ•ˆï¼›LB åªè®¤å®¹å™¨çœŸæ­£ç›‘å¬çš„ $PORTï¼ˆå¹³å°æ³¨å…¥ï¼Œå¸¸è§ 8080ï¼‰ã€‚ä½ æŠŠåº”ç”¨â€œç¡¬ç»‘ 3000â€ï¼Œåªä¼šç»§ç»­å¤±è´¥ã€‚GFE çš„ 404 ä¸æ˜¯å› ä¸º localPort=3000 æ²¡è¢«æ»¡è¶³ï¼Œè€Œæ˜¯å®¹å™¨æ²¡æœ‰åœ¨å¹³å°æ³¨å…¥ç«¯å£ä¸Šæä¾› 200 å“åº”æˆ–ä½ è®¿é—®åˆ°çš„æ˜¯æ—§éƒ¨ç½²ã€‚

æŒ‰ä¸‹é¢åšï¼Œä¸€æ¬¡ä¸€æ­¥ï¼Œèƒ½æŠŠ HTTPS 404 å¹²æ‰ã€‚

ã€ç¬¬1æ­¥ã€‘æ¢å¤â€œåªå¬ $PORTâ€ï¼Œå¹¶ç»™ / ä¸ /health æ°¸è¿œ 200

index.jsï¼ˆå…³é”®è¡Œï¼‰ï¼š

const PORT = process.env.PORT || 8080;   // âœ… åªç”¨å¹³å°æ³¨å…¥ï¼Œä¸è¦å†™æ­» 3000/80
app.get('/', (_req,res)=>res.status(200).type('text/plain').send('OK'));  // âœ… æ ¹è·¯å¾„ 200
app.get('/health', (_req,res)=>res.status(200).json({ok:true,status:'ok'})); // âœ… æ°¸è¿œ 200
console.log('ğŸ” ENV PORT =', process.env.PORT);
app.listen(PORT, '0.0.0.0', ()=>console.log('ğŸš€ listening', PORT));


ä½ åˆšæŠŠç«¯å£â€œä¿®æˆ 3000â€çš„æ”¹åŠ¨è¦æ’¤å›ã€‚ç»§ç»­ç¡¬ç»‘ 3000 ä¼šè®© LB æ¢æµ‹ä¸åˆ°æœåŠ¡ã€‚

ã€ç¬¬2æ­¥ã€‘æ¸…ç† .replitï¼Œåªä¿ç•™ deployment.runï¼ˆä¸è¦ [[ports]]ï¼‰

.replitï¼ˆç¤ºä¾‹ï¼‰ï¼š

[deployment]
deploymentTarget = "gce"
run = ["sh", "-c", "echo '--- START CMD ---'; date; env | sort | sed -n '1,40p'; node index.js"]


åˆ é™¤ [[ports]] æ®µï¼ˆå¯¹ Reserved VM æ— æ•ˆï¼‰ï¼›

run é‡ŒåŠ ä¸Šâ€œå¯è§‚æµ‹â€æ‰“å°ï¼Œæ–¹ä¾¿ç¡®è®¤æ˜¯æ–°å®¹å™¨ã€‚

è‹¥é¡¹ç›®æ ¹ç›®å½•æœ‰ Dockerfile / replit.nixï¼šä»¥å®ƒä»¬ä¸ºå‡†ï¼Œç¡®ä¿ ä¸å†™æ­» PORTï¼ŒCMD ["node","index.js"]ï¼Œç«¯å£ç”±ä»£ç è¯»å– process.env.PORTã€‚

ã€ç¬¬3æ­¥ã€‘Delete deployment â†’ Publishï¼ˆä¸æ˜¯ Republish/Resumeï¼‰

Publishing â†’ Manage â†’ Delete deploymentï¼ˆå½»åº•åˆ é™¤æ—§éƒ¨ç½²ï¼‰ï¼›

å›ç¼–è¾‘å™¨ â†’ Publish â†’ é€‰ Reserved VM â†’ Publishï¼›

éƒ¨ç½²å®Œæˆåçœ‹ Logsï¼Œå¿…é¡»å‡ºç°ï¼š

--- START CMD ---
<å½“å‰æ—¶é—´>
ENV (first 40 vars): ...
ğŸ” ENV PORT = 8080      // ç¤ºä¾‹
ğŸš€ listening 8080


è‹¥çœ‹ä¸åˆ°è¿™äº›æ–°æ ‡è®°ï¼Œè¯´æ˜ä½ è¿˜åœ¨æ—§å®¹å™¨ä¸Šè¿è¡Œï¼Œå›åˆ°è¿™ä¸€æ­¥é‡æ¥ä¸€æ¬¡ã€‚

ã€ç¬¬4æ­¥ã€‘åªç”¨â€œæœ¬æ¬¡éƒ¨ç½²çš„ Public URLâ€æµ‹ HTTPS

åœ¨éƒ¨ç½² Overview é‡Œå¤åˆ¶ Public URLï¼Œç„¶åï¼š

curl -sv https://<Public-URL>/health 2>&1 | sed -n '1,25p'


é¢„æœŸï¼š200 ä¸”è¿”å› { "ok": true, ... }ã€‚
å¦‚æœè¿˜æ˜¯ Not Found ä¸”å¤´éƒ¨æœ‰ server: Google Frontend / via: 1.1 googleï¼š

4.1 æ¸…ç©ºå†å²éƒ¨ç½²

æ‰“å¼€ Deployments åˆ—è¡¨ï¼šä»…ä¿ç•™ä¸€ä¸ª Reserved VM å¤„äº Runningï¼Œå…¶ä½™å…¨éƒ¨ Deleteï¼ˆä¸æ˜¯ Pause/Shutdownï¼Œæ˜¯ Deleteï¼‰ã€‚

å›åˆ°ä¿ç•™çš„é‚£ä¸ª â†’ Manage â†’ Shut down â†’ Startï¼ˆåˆ·æ–° 443 URL Map/å¥åº·æ£€æŸ¥ï¼‰ï¼›

å†æµ‹ https://<Public-URL>/healthã€‚

å¸¸è§çœŸå› ï¼šæ—§ Deployment å ç€ 443 çš„ç»‘å®šï¼Œ80 ä¼š 301 åˆ° HTTPSï¼Œä½† HTTPS è¿˜æŒ‡å‘æ—§åç«¯ï¼Œäºæ˜¯ä½ è§åˆ° GFE çš„ 404ã€‚

ã€ç¬¬5æ­¥ã€‘è‹¥ä»ä¸ç¨³ï¼Œç”¨æœ€å°æ¢é’ˆäºŒåˆ†ï¼ˆé”æ­» LB vs ä»£ç ï¼‰

probe.jsï¼ˆä½ å·²ç»æœ‰ï¼‰ä½œä¸ºå¯åŠ¨ï¼Œæš‚æ”¹ .replitï¼š

[deployment]
deploymentTarget = "gce"
run = ["sh", "-c", "node probe.js"]


å†æ¥ä¸€é Delete deployment â†’ Publishï¼Œåªæµ‹æœ¬æ¬¡ Public URL çš„ https://.../healthã€‚

æ­£å¸¸åˆ™ä»£ç å±‚æ²¡é—®é¢˜ï¼›

ä»æ˜¯ GFE 404ï¼Œåˆ™å¿…æ˜¯åŸŸå/æ˜ å°„ä»è½åœ¨æ—§éƒ¨ç½²æˆ–åˆ«çš„ Replâ€”â€”æŠŠå…¶ä»–éƒ¨ç½²åˆ åˆ°åªå‰©ä¸€ä¸ªï¼Œå†é‡å¯ï¼Œå³å¯å¯¹é½ã€‚

å¿«é€Ÿæ ¡éªŒæ¸…å•ï¼ˆå‡ºé—®é¢˜æ—¶åªå¯¹è¿™ 4 æ¡ï¼‰

Logs é‡Œæ˜¯å¦æœ‰ --- START CMD --- + å½“å‰æ—¶é—´ + ğŸ” ENV PORT = ... + ğŸš€ listening ...

è®¿é—®æ˜¯å¦æ˜¯ æœ¬æ¬¡éƒ¨ç½²çš„ Public URLï¼ˆä¸æ˜¯ä½ è®°å¿†ä¸­çš„æ—§äºŒçº§åŸŸï¼‰

Deployments åˆ—è¡¨é‡Œæ˜¯å¦åªå‰© ä¸€ä¸ª Running çš„ Reserved VM

é¡¹ç›®æ˜¯å¦å­˜åœ¨ Dockerfile/replit.nix/package.json scripts å†™æ­»äº† PORT=3000ï¼ˆä¸€å¾‹ç§»é™¤ï¼‰

ä½ çš„ä¸‰ä¸ªé—®é¢˜ï¼Œæ˜ç¡®å›ç­”

æ˜¯å¦éœ€è¦åˆ é™¤ deployment é‡å»ºï¼Ÿ éœ€è¦ã€‚Delete deployment â†’ Publish æ˜¯é‡åˆ· 443 ç»‘å®š/å¥åº·æ£€æŸ¥çš„å”¯ä¸€ç¨³å¦¥æ–¹å¼ã€‚

ç«¯å£é…ç½®æ˜¯å¦æ­£ç¡®ï¼Ÿ æ­£ç¡®åšæ³•æ˜¯ åªè¯» process.env.PORTã€‚[[ports]] ä¸ Reserved VM æ— å…³ï¼Œåˆ æ‰ã€‚

å¦‚ä½•ä¿®å¤ HTTPS 404ï¼Ÿ ç…§ä¸Šè¿° 5 æ­¥èµ°ï¼šæ¢å¤ $PORTã€åˆ é™¤æ—§éƒ¨ç½²é‡å»ºã€åªæµ‹ Public URLã€å¿…è¦æ—¶æ¸…ç©ºå†å²éƒ¨ç½²ï¼›è‹¥è¿˜ 404ï¼Œç”¨ probe.js äºŒåˆ†å¹¶ç»§ç»­æ’æŸ¥åŸŸåç»‘å®šã€‚

æ‰§è¡Œå®Œã€ç¬¬3æ­¥ã€‘åï¼ŒæŠŠLogs çš„å‰ 10 è¡Œå’Œ curl -sv https://<Public-URL>/health | head -n 5 è´´å‡ºæ¥ï¼Œæˆ‘å¯ä»¥æ®æ­¤ç§’åˆ¤æ˜¯å¦å·²åˆ‡åˆ°æ–°å®¹å™¨æˆ–ä»æœ‰æ—§éƒ¨ç½²å ç€ 443