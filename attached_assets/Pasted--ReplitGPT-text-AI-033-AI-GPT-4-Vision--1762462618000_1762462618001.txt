ã€ç”¨æˆ·â†’ReplitGPTã€‘

text
ã€è§†è§‰AIé›†æˆ#033 - åŸºäºç°æœ‰æ¶æ„çš„ç²¾å‡†å‡çº§ã€‘

**ç›®æ ‡**ï¼šåœ¨ç°æœ‰å¤šAIæ¶æ„ä¸­é›†æˆGPT-4 Visionï¼Œå®ç°çœŸæ­£çš„çƒ­åŠ›å›¾è§†è§‰åˆ†æ

**å®æ–½æ–¹æ¡ˆ**ï¼šåœ¨ç°æœ‰`gpt5Brain.js`åŸºç¡€ä¸Šæ‰©å±•è§†è§‰åˆ†æèƒ½åŠ›

**æ­¥éª¤1ï¼šåˆ›å»ºè§†è§‰åˆ†ææ¨¡å—**

åœ¨ç°æœ‰AIæ¶æ„ä¸­æ·»åŠ `visionAnalysis.js`ï¼š

```javascript
const fetch = require('node-fetch');

class VisionAnalysisService {
  constructor(openaiApiKey) {
    this.apiKey = openaiApiKey;
    this.baseURL = 'https://api.openai.com/v1/chat/completions';
  }

  // é›†æˆåˆ°ç°æœ‰AIè°ƒç”¨ä½“ç³»
  async analyzeHeatmapVision(imageBuffer, marketContext) {
    try {
      console.log('ğŸ‘ï¸ [è§†è§‰AI] å¼€å§‹åˆ†æçƒ­åŠ›å›¾å›¾åƒ');
      
      const base64Image = imageBuffer.toString('base64');
      
      const response = await fetch(this.baseURL, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${this.apiKey}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          model: "gpt-4-vision-preview",
          max_tokens: 1500,
          messages: [
            {
              role: "user",
              content: [
                {
                  type: "text",
                  text: `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šè‚¡ç¥¨äº¤æ˜“å‘˜ï¼Œè¯·åˆ†æè¿™å¼ ${marketContext.index}å®æ—¶çƒ­åŠ›å›¾ã€‚

åŸºäºä½ å®é™…çœ‹åˆ°çš„å›¾åƒå†…å®¹ï¼Œè¯·æä¾›ï¼š

ã€è§†è§‰ç‰¹å¾åˆ†æã€‘
1. ç»¿è‰²/çº¢è‰²æ¿å—åˆ†å¸ƒæ¯”ä¾‹
2. å¤§å¸‚å€¼è‚¡ç¥¨çš„è¡¨ç°ï¼ˆé¢œè‰²æ·±æµ…ï¼‰
3. å¸‚åœºå¹¿åº¦ï¼ˆä¸Šæ¶¨è‚¡ç¥¨æ•°é‡vsä¸‹è·Œï¼‰
4. èµ„é‡‘æµå‘é›†ä¸­åº¦

ã€äº¤æ˜“æ´å¯Ÿã€‘
1. å½“å‰æœ€å…·æ½œåŠ›çš„2-3ä¸ªå…·ä½“æ¿å—
2. éœ€è¦è­¦æƒ•çš„é£é™©ä¿¡å·
3. å…·ä½“çš„æ“ä½œå»ºè®®ï¼ˆä¹°å…¥/å–å‡º/è§‚æœ›ï¼‰

ã€è¦æ±‚ã€‘
- åŸºäºå›¾åƒå®é™…å†…å®¹è¯´è¯ï¼Œé¿å…å‡è®¾
- å¦‚æœçœ‹åˆ°å¤§é¢ç§¯ç»¿è‰²ï¼ŒæŒ‡å‡ºå»¶ç»­æ€§
- å¦‚æœçº¢ç»¿æ··æ‚ï¼Œæç¤ºéœ‡è¡ç­–ç•¥
- æä¾›å¯æ‰§è¡Œçš„äº¤æ˜“æ€è·¯

å¸‚åœºèƒŒæ™¯ï¼š${marketContext.index} (${marketContext.region})`
                },
                {
                  type: "image_url",
                  image_url: {
                    url: `data:image/png;base64,${base64Image}`,
                    detail: "high"
                  }
                }
              ]
            }
          ]
        })
      });

      if (!response.ok) {
        throw new Error(`è§†è§‰APIé”™è¯¯: ${response.status}`);
      }

      const data = await response.json();
      const analysis = data.choices[0].message.content;
      
      console.log('âœ… [è§†è§‰AI] åˆ†æå®Œæˆ');
      return analysis;
      
    } catch (error) {
      console.error('âŒ [è§†è§‰AI] åˆ†æå¤±è´¥:', error.message);
      throw new Error(`è§†è§‰åˆ†ææš‚æ—¶ä¸å¯ç”¨: ${error.message}`);
    }
  }

  // å¤‡é€‰æ–¹æ¡ˆï¼šä½¿ç”¨ç°æœ‰GPT-5è¿›è¡Œæ¨¡å¼æè¿°åˆ†æ
  async analyzeHeatmapFallback(marketContext, gpt5Brain) {
    console.log('ğŸ”„ [å¤‡é€‰åˆ†æ] ä½¿ç”¨æ–‡æœ¬åˆ†æ');
    
    const prompt = `
ä½œä¸ºä¸“ä¸šäº¤æ˜“å‘˜ï¼ŒåŸºäº${marketContext.index}çƒ­åŠ›å›¾çš„å…¸å‹æ¨¡å¼æä¾›åˆ†ææ¡†æ¶ï¼š

è¯·ç”¨æˆ·è§‚å¯Ÿçƒ­åŠ›å›¾å¹¶å…³æ³¨ï¼š
1. ç»¿è‰²æ¿å—é›†ä¸­åº¦ - åæ˜ èµ„é‡‘æµå‘
2. çº¢è‰²æ¿å—åˆ†å¸ƒ - è¯†åˆ«é£é™©åŒºåŸŸ  
3. å¤§å¸‚å€¼è‚¡ç¥¨é¢œè‰² - åˆ¤æ–­æƒé‡è‚¡è¡¨ç°
4. æ•´ä½“é¢œè‰²åˆ†å¸ƒ - è¯„ä¼°å¸‚åœºå¹¿åº¦

åŸºäºå¸¸è§æ¨¡å¼æä¾›æ“ä½œå»ºè®®ã€‚
    `;
    
    return await gpt5Brain.analyze(prompt);
  }
}

module.exports = VisionAnalysisService;
æ­¥éª¤2ï¼šé›†æˆåˆ°ç°æœ‰çƒ­åŠ›å›¾æµç¨‹

ä¿®æ”¹heatmapService.jsï¼Œåœ¨ç°æœ‰æµç¨‹ä¸­æ’å…¥è§†è§‰åˆ†æï¼š

javascript
// åœ¨æ–‡ä»¶é¡¶éƒ¨å¼•å…¥è§†è§‰æœåŠ¡
const VisionAnalysisService = require('./visionAnalysis');

async function generateSmartHeatmap(userText) {
  console.log(`\nğŸ¯ [è§†è§‰åˆ†ææ¨¡å¼] å¤„ç†: "${userText}"`);
  
  // 1. ç°æœ‰æ„å›¾è§£æå’ŒURLç”Ÿæˆ
  const query = extractHeatmapQueryRulesOnly(userText);
  const tradingViewUrl = buildTradingViewURL(query);
  
  // 2. ç”Ÿæˆçƒ­åŠ›å›¾ï¼ˆç°æœ‰æµç¨‹ï¼‰
  const heatmapResult = await captureHeatmapSmart({ tradingViewUrl });
  
  // 3. è§†è§‰AIåˆ†æï¼ˆæ–°å¢ï¼‰
  try {
    const visionService = new VisionAnalysisService(process.env.OPENAI_API_KEY);
    const marketContext = {
      index: query.index,
      region: query.region,
      sector: query.sector
    };
    
    const visualAnalysis = await visionService.analyzeHeatmapVision(
      heatmapResult.buffer,
      marketContext
    );
    
    return {
      ok: true,
      buffer: heatmapResult.buffer,
      caption: visualAnalysis,
      analysis_type: 'vision_based',
      elapsed_ms: heatmapResult.elapsed_ms
    };
    
  } catch (visionError) {
    console.log('ğŸ”„ è§†è§‰åˆ†æå¤±è´¥ï¼Œä½¿ç”¨å¤‡é€‰æ–¹æ¡ˆ');
    
    // ä½¿ç”¨ç°æœ‰GPT-5è¿›è¡Œå¤‡é€‰åˆ†æ
    const { gpt5Brain } = require('./gpt5Brain');
    const fallbackAnalysis = await visionService.analyzeHeatmapFallback(
      { index: query.index, region: query.region },
      gpt5Brain
    );
    
    return {
      ok: true,
      buffer: heatmapResult.buffer,
      caption: `ğŸ“Š ${query.index}çƒ­åŠ›å›¾å·²ç”Ÿæˆ\n\n${fallbackAnalysis}`,
      analysis_type: 'text_fallback',
      elapsed_ms: heatmapResult.elapsed_ms
    };
  }
}
æ­¥éª¤3ï¼šæ›´æ–°ç³»ç»Ÿé…ç½®

åœ¨config/models.jsonä¸­æ·»åŠ è§†è§‰AIé…ç½®ï¼š

json
{
  "primary": { "id": "gpt-5-mini", "max_tokens": 4000, "timeout_ms": 45000 },
  "fallback": [
    { "id": "gpt-4o", "max_tokens": 3000, "timeout_ms": 30000 },
    { "id": "gpt-4o-mini", "max_tokens": 2000, "timeout_ms": 20000 }
  ],
  "vision": {
    "model": "gpt-4-vision-preview",
    "max_tokens": 1500,
    "timeout_ms": 30000,
    "detail": "high"
  }
}
æ­¥éª¤4ï¼šæˆæœ¬ä¼˜åŒ–ç­–ç•¥

ç”±äºGPT-4 Visionæœ‰æˆæœ¬è€ƒè™‘ï¼Œæ·»åŠ æ™ºèƒ½è°ƒç”¨é€»è¾‘ï¼š

javascript
// åœ¨visionAnalysis.jsä¸­æ·»åŠ æˆæœ¬æ§åˆ¶
shouldUseVisionAnalysis(userTier, marketVolatility) {
  // æ ¹æ®ç”¨æˆ·ç­‰çº§å’Œå¸‚åœºæ³¢åŠ¨æ€§å†³å®šæ˜¯å¦ä½¿ç”¨è§†è§‰åˆ†æ
  const userTiers = {
    'premium': true,    // é«˜çº§ç”¨æˆ·å§‹ç»ˆä½¿ç”¨
    'standard': true,   // æ ‡å‡†ç”¨æˆ·ä¸»è¦å¸‚åœºä½¿ç”¨
    'basic': false      // åŸºç¡€ç”¨æˆ·ä½¿ç”¨æ–‡æœ¬åˆ†æ
  };
  
  const importantMarkets = ['NIKKEI225', 'SPX500', 'HSI', 'DAX'];
  
  return userTiers[userTier] && importantMarkets.includes(marketVolatility);
}
å®æ–½ä¼˜åŠ¿ï¼š

âœ… æ— ç¼é›†æˆ - åˆ©ç”¨ç°æœ‰OpenAIé…ç½®ï¼Œæ— éœ€é¢å¤–æœåŠ¡

âœ… æ•…éšœè½¬ç§» - è§†è§‰åˆ†æå¤±è´¥æ—¶è‡ªåŠ¨å›é€€åˆ°æ–‡æœ¬åˆ†æ

âœ… æˆæœ¬å¯æ§ - æ·»åŠ æ™ºèƒ½è°ƒç”¨ç­–ç•¥æ§åˆ¶APIæˆæœ¬

âœ… ç«‹å³ç”Ÿæ•ˆ - åŸºäºç°æœ‰æ¶æ„ï¼Œä¿®æ”¹æœ€å°

é¢„æœŸæ•ˆæœï¼š

çƒ­åŠ›å›¾åˆ†æä»"å‡è®¾æ€§"å‡çº§ä¸º"åŸºäºå®é™…å›¾åƒå†…å®¹"

æä¾›ç²¾å‡†çš„æ¿å—è¯†åˆ«å’Œäº¤æ˜“å»ºè®®

ä¿æŒç³»ç»Ÿç¨³å®šæ€§å’Œç°æœ‰å¤šAIåä½œæ¶æ„

è¯·ç«‹å³å®æ–½è¿™ä¸ªè§†è§‰AIé›†æˆæ–¹æ¡ˆï¼

text

## ğŸ¯ å®æ–½ä¼˜å…ˆçº§

åŸºäºç°æœ‰æ¶æ„ï¼Œæˆ‘å»ºè®®ï¼š
1. **ç«‹å³å®æ–½**ï¼šGPT-4 Visioné›†æˆï¼ˆåˆ©ç”¨ç°æœ‰OpenAIé…ç½®ï¼‰
2. **åç»­ä¼˜åŒ–**ï¼šæˆæœ¬æ§åˆ¶ç­–ç•¥å’Œç”¨æˆ·åˆ†çº§
3. **é•¿æœŸè§„åˆ’**ï¼šè€ƒè™‘Claude 3 Visionä½œä¸ºå¤‡é€‰è§†è§‰AI

è¿™ä¸ªæ–¹æ¡ˆç›´æ¥è§£å†³äº†"AIçœ‹ä¸åˆ°çƒ­åŠ›å›¾"çš„æ ¸å¿ƒé—®é¢˜ï¼Œè€Œä¸”å®Œå…¨åŸºäºæ‚¨ç°æœ‰çš„æŠ€æœ¯æ ˆã€‚

è¯·å°†ä¸Šè¿°æ–¹æ¡ˆè½¬å‘ç»™ReplitGPTæ‰§è¡Œï¼