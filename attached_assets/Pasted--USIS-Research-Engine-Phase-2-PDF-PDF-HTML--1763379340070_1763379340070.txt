ä½ ç°åœ¨æ‰§è¡Œ USIS Research Engine â€“ Phase 2 ä¿®å¤ï¼ˆPDF æ¸²æŸ“é“¾è·¯ä¿®å¤ï¼‰ã€‚
æœ¬é˜¶æ®µé‡ç‚¹ï¼š
è®©æœ€ç»ˆ PDF ä½¿ç”¨æ–°ç‰ˆ HTML æ¨¡æ¿ï¼ˆå«å›¾è¡¨ã€æŠ€æœ¯æŒ‡æ ‡ç­‰ï¼‰ã€‚

ç¦æ­¢ä¿®æ”¹å…¶å®ƒæ¨¡å—çš„é€»è¾‘ï¼Œåªä¿® PDF æ¸²æŸ“é“¾è·¯ã€‚

ğŸŸ¦ã€Phase 2 â€“ ä»»åŠ¡ç›®æ ‡ã€‘

è®© PDF ç”Ÿæˆä½¿ç”¨ renderFullReportHtml()ï¼ˆæˆ–æœ€æ–° HTML æ„å»ºé€»è¾‘ï¼‰

ç¡®ä¿ <img src="quickchart.io/..."> å‡ºç°åœ¨ä¼ ç»™ DocRaptor çš„ HTML

ç¡®ä¿ techs.support_level å’Œ techs.resistance_level è¿›å…¥ PDF

ç¦æ­¢ç»§ç»­ä½¿ç”¨æ—§æ¨¡æ¿ï¼ˆreport.htmlã€pdf_template.html ç­‰ï¼‰

ğŸŸ¦ã€æ­¥éª¤ 1ï¼šå®šä½ PDF æ¸²æŸ“å…¥å£ã€‘

è¯·æœç´¢ï¼š

rg -n "DocRaptor" -g '*.js'
rg -n "pdf" -g '*.js'
rg -n "createPDF" -g '*.js'
rg -n "generatePDF" -g '*.js'


æ‰¾åˆ° 1~2 ä¸ªæ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š

v3_dev/services/pdfService.js

v3_dev/services/reportService.js

v3_dev/utils/pdf.js

è¿™äº›æ–‡ä»¶ä¸­éšè—ç€æ—§æ¨¡æ¿è°ƒç”¨ç‚¹ã€‚

è¾“å‡ºè·¯å¾„ç”¨äºç¡®è®¤ã€‚

ğŸŸ¦ã€æ­¥éª¤ 2ï¼šæ‰“å°å½“å‰ DocRaptor æ¥æ”¶åˆ°çš„ HTMLï¼ˆå¿…é¡»ï¼‰ã€‘

åœ¨è°ƒç”¨ DocRaptor API çš„åœ°æ–¹ åŠ å…¥ä»¥ä¸‹ debugï¼š

console.log("======== PDF DEBUG START ========");
console.log("[PDF] HTML length:", htmlContent.length);
console.log("[PDF] Contains <img>? ->", htmlContent.includes("<img") ? "YES" : "NO");
console.log("[PDF] Contains QuickChart URLs? ->", (htmlContent.match(/quickchart\.io/g) || []).length);
console.log("[PDF] Contains TECHNICAL SECTION? ->", htmlContent.includes("Technical Indicators"));
console.log("======== PDF DEBUG END ==========");


ç¡®ä¿ä½ æ‰“å°çš„æ˜¯ ä¼ ç»™ DocRaptor çš„æœ€ç»ˆ HTML å­—ç¬¦ä¸²ï¼Œ
ä¸æ˜¯ä¸­é—´äº§ç‰©ã€‚

ğŸŸ¦ã€æ­¥éª¤ 3ï¼šæ£€æŸ¥ HTML æ„å»ºå‡½æ•°ã€‘

è¯·æœç´¢ä»¥ä¸‹å‡½æ•°ï¼š

renderFullReportHtml
renderPage10
renderReportHTML
buildReportHtml


è¾“å‡ºæ‰€æœ‰åŒ¹é…å¤„ï¼Œç¡®å®šæœ€ç»ˆ HTML æ˜¯ç”±å“ªä¸ªå‡½æ•°ç”Ÿæˆçš„ã€‚

ğŸŸ¦ã€æ­¥éª¤ 4ï¼šå¼ºåˆ¶ PDF ä½¿ç”¨æ–°ç‰ˆ HTML ğŸ‘‡ï¼ˆæœ€å…³é”®ä¸€åˆ€ï¼‰ã€‘

åœ¨ PDF æ¸²æŸ“å‡½æ•°ä¸­ï¼Œå°†ï¼š

const html = oldTemplate(...);


æˆ–ï¼š

const html = fs.readFileSync("report_template.html");


æˆ–ï¼š

const html = this.buildLegacyReport();


ä¸€å¾‹æ”¹ä¸ºï¼š

const html = await renderFullReportHtml(report);


å¦‚æœå®é™…å‡½æ•°åæ˜¯ï¼š

renderReportHtml

buildFullHtml

renderPageAll

ä¹Ÿè¯·æ›¿æ¢æˆæœ€æ–°çš„ã€åŒ…å« <img> çš„ HTML æ„å»ºå‡½æ•°ã€‚

ç¦æ­¢ç»§ç»­ä½¿ç”¨æ—§ HTML æ¨¡æ¿æ–‡ä»¶ã€‚

ğŸŸ¦ã€æ­¥éª¤ 5ï¼šç¡®è®¤ techs.* åœ¨ HTML ä¸­å‡ºç°ã€‘

åœ¨ HTML æ¸²æŸ“å‡½æ•°ï¼ˆä¾‹å¦‚ renderPage13ï¼‰é‡ŒåŠ å…¥ï¼š

<p>Support: ${report.techs?.support_level ?? 'N/A'}</p>
<p>Resistance: ${report.techs?.resistance_level ?? 'N/A'}</p>


ç„¶ååœ¨æœ€åçš„ HTML debug æ‰“å°é‡Œç¡®è®¤ï¼š

Support: 180.58
Resistance: 212.19


å¦‚æœæ²¡æœ‰ï¼Œè¯´æ˜æ¸²æŸ“é€»è¾‘æ¼æ‰äº† techs éƒ¨åˆ†ã€‚

ğŸŸ¦ã€æ­¥éª¤ 6ï¼šæ‰§è¡Œ PDF æµ‹è¯•ã€‘

ä¿®æ”¹å®Œæˆåï¼Œè¯·æ‰§è¡Œä¸€æ¬¡å†…éƒ¨æµ‹è¯•ï¼š

node v3_dev/test_financial_integration.js


å¹¶è¾“å‡ºï¼š

[PDF DEBUG] æ®µè½

QuickChart URL æ•°é‡

techs æ˜¾ç¤ºæƒ…å†µ

æµ‹è¯•é€šè¿‡æ ‡å‡†ï¼š

[PDF] Contains <img>? -> YES

[PDF] Contains QuickChart URLs? -> >= 3

PDF ä¸å†æ˜¾ç¤º â€œPlaceholderâ€

Technical Analysis ä¸å†æ˜¾ç¤º â€œSupport: N/Aâ€

ğŸŸ¦ã€æœ€ç»ˆè¾“å‡ºè¦æ±‚ã€‘

ä¿®å¤å®Œæˆåï¼Œè¯·è¾“å‡ºï¼š

Phase 2 PDF renderer fixed.
New HTML template confirmed in DocRaptor payload.
Charts embedded + technical levels integrated.
Ready for next NVDA PDF generation.


ç¦æ­¢åšä»»ä½•å…¶ä»–æ›´æ”¹ã€‚