ä½ ç°åœ¨æ‰§è¡Œ USIS Research Brain â€” Phase 1 Repair (Three Critical Fixes)ã€‚
æœ¬ä»»åŠ¡ä¸¥æ ¼é™å®šä¸ºï¼š
ä¿®å¤ 1) å¥å°¾ã€2) å›¾è¡¨åµŒå…¥ã€3) æŠ€æœ¯æŒ‡æ ‡åŸºç¡€è®¡ç®—ã€‚
ç¦æ­¢æ”¹åŠ¨å…¶å®ƒæ¨¡å—çš„é€»è¾‘ã€‚

ğŸŸ¦ã€ä»»åŠ¡ 1ï¼šä¿®å¤ TasteTruthLayer çš„å¥å°¾ & å¥å­ç ´æŸé—®é¢˜ã€‘

è¯·åœ¨ v3_dev/services/tasteTruthLayer.js ä¸­æŒ‰ä»¥ä¸‹è¦æ±‚ä¿®ï¼š

1.1 ä¿®å¤ â€œ..â€ åŒç‚¹å·é—®é¢˜

åœ¨ TasteTruthLayer çš„æœ€åè¾“å‡ºæ­¥éª¤åŠ å…¥ï¼š

corrected = corrected.replace(/\.\.+/g, '.');   // æŠŠ ".." "..." ç»Ÿç»Ÿå˜æˆ "."
corrected = corrected.replace(/ \./g, '.');     // ç§»é™¤ " ." è¿™ç±»è„ç©ºæ ¼

1.2 ä¸è¦å†åˆ é™¤å¹´ä»½å¯¼è‡´å¥å­æ–­è£‚

åˆ é™¤æˆ–æ³¨é‡Šæ‰ä»¥ä¸‹ aggressive è§„åˆ™ï¼ˆReplit è‡ªå·±è¯Šæ–­å‡ºæ¥çš„é—®é¢˜ï¼‰ï¼š

åˆ é™¤æ‰€æœ‰ 2022â€“2025 çš„æ•´å¥

åˆ é™¤æ‰€æœ‰ "Q1/Q2/Q3/Q4 YYYY" çš„æ•´å¥

ä»»ä½•å¯¼è‡´ â€œby the end ofâ€ / â€œover recent quarters couldâ€¦â€ ç•™ä¸‹ä¸å®Œæ•´å¥å­çš„è§„åˆ™

æŠŠè¿™äº› block æ›¿æ¢æˆï¼š

// å¦‚æœå¥å­åŒ…å«å¹´ä»½ï¼Œä½†å¹´ä»½æ— æ³•ç¡®è®¤ï¼Œä¿ç•™å¥å­ä½†æ›¿æ¢å¹´ä»½ä¸º "recent periods"
corrected = corrected.replace(/\b202[2-5]\b/g, "recent periods");

// å…è®¸å­£åº¦å‡ºç°ï¼Œä½†æ ‡å‡†åŒ–æ ¼å¼
corrected = corrected.replace(/\bQ([1-4]) 202[2-5]\b/g, "recent quarters");

1.3 å¢åŠ ç®€å•çš„â€œå¥å­å®Œæ•´æ€§æ£€æŸ¥å™¨â€

åœ¨ TasteTruthLayer æœ«å°¾åŠ å…¥ï¼š

corrected = corrected
  .split('.')
  .map(s => s.trim())
  .filter(s => s.length > 0)
  .map(s => {
    // åˆ é™¤åªæœ‰ "by the end of" / "over recent quarters could" è¿™ç§ä¸å®Œæ•´å¥å­
    if (/by the end of$/.test(s)) return null;
    if (/over recent quarters could$/.test(s)) return null;
    return s;
  })
  .filter(Boolean)
  .join('. ') + '.';

ğŸŸ¦ã€ä»»åŠ¡ 2ï¼šä¿®å¤ PDF å›¾è¡¨åµŒå…¥ï¼ˆæœ€é‡è¦ï¼‰ã€‘

å½“å‰æ¸²æŸ“å™¨ï¼ˆDocRaptorï¼‰ä»ç„¶ä½¿ç”¨ æ—§ HTML æ¨¡æ¿ã€‚

è¯·æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

2.1 æœç´¢æ•´ä¸ªé¡¹ç›®ä¸­æ‰€æœ‰ä½¿ç”¨ DocRaptor çš„ä½ç½®
rg -n "DocRaptor" -g '*.js'


æ‰¾åˆ°è´Ÿè´£æŠŠ HTML ä¼ ç»™ DocRaptor çš„æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ pdfService.js æˆ–ç±»ä¼¼åå­—ï¼‰ã€‚

2.2 ç¡®ä¿å®é™…ä¼ å…¥ PDF çš„ HTML ä½¿ç”¨ æ–°çš„ renderPage10() HTML

å°† PDF æ¸²æŸ“å‰çš„ HTML æ‰“å°å‡ºæ¥ï¼ˆåŠ å…¥ debugï¼‰ï¼š

console.log("[PDF DEBUG] HTML length=", html.length);
console.log("[PDF DEBUG] HTML preview=", html.slice(0, 500));
console.log("[PDF DEBUG] Charts included?",
    html.includes("quickchart.io") ? "YES" : "NO");

2.3 è‹¥ PDF ç”¨çš„æ˜¯æ—§æ¨¡æ¿ï¼Œä¿®æ”¹ä¸ºä½¿ç”¨æ–°æ¨¡æ¿

ç¡®ä¿æœ€ç»ˆ HTML æ˜¯ï¼š

const html = fullReportHtml;  // å¿…é¡»åŒ…å« renderPage10() ç”Ÿæˆçš„ <img>


ä¸è¦å†ä½¿ç”¨ç¡¬ç¼–ç  templateï¼Œä¸è¦ä½¿ç”¨æ—§çš„ HTML æ–‡ä»¶ã€‚

2.4 å°†ä»¥ä¸‹å›¾è¡¨æ’å…¥ PDFï¼ˆå®ƒä»¬åœ¨ report.charts.* ä¸­ï¼‰ï¼š
<img src="{{report.charts.revenue_5y}}" style="width:100%; max-width:800px;">
<img src="{{report.charts.eps_5y}}" style="width:100%; max-width:800px;">
<img src="{{report.charts.financial_trends}}" style="width:100%; max-width:800px;">


å¦‚æœ QuickChart URL ä¸º nullï¼Œæ˜¾ç¤ºï¼š

<div>Historical chart unavailable</div>

ğŸŸ¦ã€ä»»åŠ¡ 3ï¼šå®ç°åŸºç¡€ç‰ˆ TechnicalEngineï¼ˆä¸å†å‡ºç° N/Aï¼‰ã€‘

è¯·åœ¨ v3_dev/services/technicalEngine.js åˆ›å»º æœ€å°å¯ç”¨ç‰ˆæœ¬ï¼š

3.1 æ–‡ä»¶è·¯å¾„
v3_dev/services/technicalEngine.js

3.2 è¾“å‡ºç»“æ„ï¼ˆæœ€åŸºç¡€ï¼‰
module.exports = {
  calculateBasicTechs
};

function calculateBasicTechs(price, high52w, low52w, intradayHigh, intradayLow) {
  return {
    support_level: intradayLow || low52w,
    resistance_level: high52w,
    rsi_14: null,     // æš‚æ—¶å…ˆä¸è®¡ç®—
    macd: null,
    ema_20: null,
    ema_50: null,
    ema_200: null
  };
}

3.3 æ¥å…¥ reportService.jsï¼ˆPhase 1.8ï¼‰

åœ¨ä»·æ ¼æ•°æ®è·å–ä¹‹ååŠ å…¥ï¼š

const TechnicalEngine = require('./technicalEngine');
report.techs = TechnicalEngine.calculateBasicTechs(
    report.price,
    report.high_52w,
    report.low_52w,
    report.intraday_high,
    report.intraday_low
);


è¿™æ ·è‡³å°‘ï¼š

Support â‰  N/A

Resistance â‰  N/A

PDF é‡Œä¸ä¼šå†å‡ºç°â€œSupport: N/A / Resistance: N/Aâ€ã€‚

ğŸŸ¦ã€æœ€åæ‰§è¡Œè¾“å‡ºã€‘

å®Œæˆåè¯·è¾“å‡ºï¼š

Phase 1 Repairs completed:
- TasteTruthLayer fixed
- PDF chart embedding fixed
- Basic TechnicalEngine added
Ready for new NVDA report test.


ç¦æ­¢åšä»»ä½•å…¶å®ƒä¿®å¤ã€‚